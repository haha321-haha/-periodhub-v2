
åŸºäºæ‚¨æä¾›çš„åˆ†ææŠ¥å‘Š,æˆ‘ç»™å‡ºä»¥ä¸‹ä¸“ä¸šå»ºè®®:

## ğŸ¯ ç«‹å³è¡ŒåŠ¨å»ºè®®

### 1. ä¿®å¤å“åº”å¤´æ ¼å¼é—®é¢˜(æœ€é«˜ä¼˜å…ˆçº§)

è¿™ä¸ªé—®é¢˜è™½ç„¶ä¸å½±å“åŠŸèƒ½,ä½†å½±å“ä»£ç è´¨é‡ã€‚å»ºè®®ç«‹å³ä¿®æ”¹:

```typescript
headers: {
  "Content-Type": "text/html; charset=utf-8",
  "Cache-Control": "no-cache, no-store, must-revalidate",
  "Pragma": "no-cache",
  "Expires": "0",
  "X-Preview-Detected": "true",
}
```

**æ‰§è¡Œå‘½ä»¤:**
```bash
# è‡ªåŠ¨æ ¼å¼åŒ–
npx prettier --write middleware.ts

# æäº¤æ›´æ”¹
git add middleware.ts
git commit -m "fix: ç»Ÿä¸€å“åº”å¤´æ ¼å¼,ä¿æŒä»£ç ä¸€è‡´æ€§"
git push
```

---

### 2. è¯Šæ–­æ„å»ºè­¦å‘Š(é«˜ä¼˜å…ˆçº§)

3ä¸ªæ„å»ºè­¦å‘Šå¯èƒ½éšè—é‡è¦é—®é¢˜ã€‚å»ºè®®æŒ‰ä»¥ä¸‹é¡ºåºæ’æŸ¥:

**æ­¥éª¤1: æœ¬åœ°é‡ç°è­¦å‘Š**
```bash
# æ¸…ç†å¹¶é‡æ–°æ„å»º
rm -rf .next
npm run build
```

**æ­¥éª¤2: æ£€æŸ¥å¸¸è§è­¦å‘Šç±»å‹**æ ¹æ®æœç´¢ç»“æœ,å¸¸è§çš„ Next.js/Vercel æ„å»ºè­¦å‘Šé€šå¸¸åŒ…æ‹¬:

- **ESLint è­¦å‘Š**: ä»£ç é£æ ¼æˆ–æ½œåœ¨é—®é¢˜
- **TypeScript ç±»å‹è­¦å‘Š**: ç±»å‹ä¸åŒ¹é…
- **React Hooks ä¾èµ–è­¦å‘Š**: useEffect/useMemo ç¼ºå°‘ä¾èµ–é¡¹
- **å›¾ç‰‡ä¼˜åŒ–è­¦å‘Š**: ä½¿ç”¨ `<img>` è€Œé `next/image`
- **ç¼“å­˜ç›¸å…³è­¦å‘Š**: .next æ–‡ä»¶å¤¹æ®‹ç•™é—®é¢˜

**æ¨èè¯Šæ–­æµç¨‹:**

```bash
# 1. æŸ¥çœ‹ Vercel å®Œæ•´æ—¥å¿—
# åœ¨ Vercel Dashboard â†’ Deployments â†’ ç‚¹å‡»æœ€æ–°éƒ¨ç½² â†’ Logs

# 2. æœ¬åœ°æ¸…ç†å¹¶é‡æ–°æ„å»º
rm -rf .next
rm -rf node_modules/.cache
npm run build 2>&1 | tee build.log

# 3. è¿è¡Œ ESLint æ£€æŸ¥
npm run lint

# 4. TypeScript ç±»å‹æ£€æŸ¥
npx tsc --noEmit
```

---

### 3. éªŒè¯ Vercel é¢„è§ˆæˆªå›¾åŠŸèƒ½(é«˜ä¼˜å…ˆçº§)

è¿™æ˜¯æ ¸å¿ƒåŠŸèƒ½,éœ€è¦ç¡®è®¤æ˜¯å¦çœŸæ­£è§£å†³äº†é—®é¢˜ã€‚

**éªŒè¯æ­¥éª¤:**

```bash
# 1. æµ‹è¯•é¢„è§ˆæ£€æµ‹é€»è¾‘
curl -H "User-Agent: Mozilla/5.0 (X11; Linux x86_64) Firefox/92.0" \
     -I https://your-domain.vercel.app/

# æŸ¥çœ‹å“åº”å¤´ä¸­æ˜¯å¦æœ‰:
# X-Preview-Detected: true
# Cache-Control: no-cache, no-store, must-revalidate

# 2. æµ‹è¯•é™æ€ HTML å“åº”
curl -H "User-Agent: Mozilla/5.0 (X11; Linux x86_64) Firefox/92.0" \
     https://your-domain.vercel.app/ | head -50

# åº”è¯¥çœ‹åˆ°é™æ€ HTML å†…å®¹,è€Œé JavaScript é‡å®šå‘
```

**å¦‚æœé¢„è§ˆæˆªå›¾ä»ç„¶å¤±è´¥:**

å¯èƒ½éœ€è¦å¢å¼ºæ£€æµ‹é€»è¾‘ã€‚Vercel çš„æˆªå›¾çˆ¬è™«å¯èƒ½ä½¿ç”¨ä¸åŒçš„ User-Agent:

```typescript
// å¢å¼ºç‰ˆæ£€æµ‹é€»è¾‘
const isVercelPreview =
  // åŸæœ‰æ£€æµ‹
  userAgent.toLowerCase().includes("vercel") ||
  host.includes(".vercel.app") ||

  // æ–°å¢æ£€æµ‹
  userAgent.toLowerCase().includes("preview") ||
  userAgent.toLowerCase().includes("screenshot") ||
  userAgent.toLowerCase().includes("bot") ||
  request.headers.get("x-vercel-id") !== null ||
  request.headers.get("x-vercel-deployment-id") !== null ||

  // ç¯å¢ƒå˜é‡æ£€æµ‹
  process.env.VERCEL_ENV === "preview";
```

---

## ğŸ¯ ä¼˜å…ˆçº§çŸ©é˜µ

| ä¼˜å…ˆçº§ | é—®é¢˜ | å½±å“ | å·¥ä½œé‡ | ç«‹å³æ‰§è¡Œ |
|-------|------|------|--------|---------|
| ğŸ”´ P0 | å“åº”å¤´æ ¼å¼ | ä»£ç è´¨é‡ | 2åˆ†é’Ÿ | âœ… |
| ğŸ”´ P0 | æŸ¥çœ‹æ„å»ºè­¦å‘Š | åŠŸèƒ½/æ€§èƒ½ | 5åˆ†é’Ÿ | âœ… |
| ğŸŸ¡ P1 | éªŒè¯é¢„è§ˆæˆªå›¾ | æ ¸å¿ƒåŠŸèƒ½ | 10åˆ†é’Ÿ | âœ… |
| ğŸŸ¢ P2 | ä»£ç æ ¼å¼åŒ– | ä»£ç è´¨é‡ | 1åˆ†é’Ÿ | â³ |

---

## ğŸ“‹ å®Œæ•´æ‰§è¡Œæ¸…å•

### ç«‹å³æ‰§è¡Œ(5-10åˆ†é’Ÿ)

```bash
# 1. ä¿®å¤å“åº”å¤´æ ¼å¼
# æ‰‹åŠ¨ç¼–è¾‘ middleware.ts,æ·»åŠ å¼•å·åˆ° Pragma å’Œ Expires

# 2. æ ¼å¼åŒ–ä»£ç 
npx prettier --write middleware.ts

# 3. æŸ¥çœ‹æ„å»ºè­¦å‘Š
rm -rf .next
npm run build 2>&1 | grep -i "warning"

# 4. è¿è¡Œå®Œæ•´æ£€æŸ¥
npm run lint
npx tsc --noEmit

# 5. æäº¤å¹¶éƒ¨ç½²
git add .
git commit -m "fix: ç»Ÿä¸€å“åº”å¤´æ ¼å¼å¹¶ä¿®å¤æ„å»ºè­¦å‘Š"
git push

# 6. ç­‰å¾… Vercel éƒ¨ç½²(çº¦2-3åˆ†é’Ÿ)
```

### éªŒè¯é˜¶æ®µ(5åˆ†é’Ÿ)

```bash
# 1. æ£€æŸ¥ Vercel éƒ¨ç½²çŠ¶æ€
# è®¿é—® Vercel Dashboard ç¡®è®¤éƒ¨ç½²æˆåŠŸ

# 2. éªŒè¯å“åº”å¤´
curl -I https://your-domain.vercel.app/

# 3. æ£€æŸ¥é¢„è§ˆæˆªå›¾
# åœ¨ Vercel Dashboard æŸ¥çœ‹é¢„è§ˆæˆªå›¾

# 4. æµ‹è¯•å®é™…åŠŸèƒ½
# è®¿é—®å®é™… URL,ç¡®è®¤é‡å®šå‘æ­£å¸¸å·¥ä½œ
```

---

## ğŸ’¡ é•¿æœŸæ”¹è¿›å»ºè®®

### 1. è®¾ç½® pre-commit hooks

```bash
# å®‰è£… husky
npm install --save-dev husky

# åˆå§‹åŒ–
npx husky install

# æ·»åŠ  pre-commit hook
npx husky add .husky/pre-commit "npm run lint && npm run type-check"
```

### 2. é…ç½® CI/CD æ£€æŸ¥

```yaml
# .github/workflows/ci.yml
name: CI
on: [push, pull_request]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Setup Node
        uses: actions/setup-node@v3
        with:
          node-version: '18'
      - run: npm ci
      - run: npm run lint
      - run: npm run type-check
      - run: npm run build
```

### 3. æ·»åŠ æ„å»ºç›‘æ§

```typescript
// next.config.js
module.exports = {
  // å°†è­¦å‘Šè§†ä¸ºé”™è¯¯(å¯é€‰,ç”¨äºä¸¥æ ¼æ¨¡å¼)
  eslint: {
    ignoreDuringBuilds: false,
  },
  typescript: {
    ignoreBuildErrors: false,
  },
}
```

---

## ğŸ¬ æ€»ç»“

**å½“å‰çŠ¶æ€**: éƒ¨ç½²æˆåŠŸ,ä½†å­˜åœ¨ä»£ç è´¨é‡å’ŒéªŒè¯é—®é¢˜

**æ ¸å¿ƒè¡ŒåŠ¨**:
1. âœ… ç«‹å³ä¿®å¤å“åº”å¤´æ ¼å¼(2åˆ†é’Ÿ)
2. âœ… æŸ¥çœ‹å¹¶ä¿®å¤æ„å»ºè­¦å‘Š(5åˆ†é’Ÿ)
3. âœ… éªŒè¯é¢„è§ˆæˆªå›¾åŠŸèƒ½(5åˆ†é’Ÿ)

**é¢„æœŸç»“æœ**:
- ä»£ç è´¨é‡æå‡
- æ— æ„å»ºè­¦å‘Š
- é¢„è§ˆæˆªå›¾æ­£å¸¸å·¥ä½œ
- é•¿æœŸå¯ç»´æŠ¤æ€§å¢å¼º

éœ€è¦æˆ‘å¸®ä½ ç”Ÿæˆå…·ä½“çš„ä¿®å¤ä»£ç å—?æˆ–è€…ä½ æƒ³å…ˆæŸ¥çœ‹ Vercel çš„å®Œæ•´æ„å»ºæ—¥å¿—?







import { NextRequest, NextResponse } from "next/server";

// æç®€çš„é¢„è§ˆæ£€æµ‹å‡½æ•°
function isVercelScreenshotBot(request: NextRequest): boolean {
  const userAgent = request.headers.get("user-agent")?.toLowerCase() || "";

  // 1. æ£€æµ‹ Vercelbotï¼ˆå®˜æ–¹æˆªå›¾æœåŠ¡ï¼‰
  if (userAgent.includes("vercelbot")) {
    return true;
  }

  // 2. æ£€æµ‹å…¶ä»–åŒ…å« "bot" çš„çˆ¬è™«
  if (userAgent.includes("bot")) {
    return true;
  }

  // 3. æ£€æµ‹ Vercel è¯·æ±‚å¤´
  if (request.headers.get("x-vercel-id")) {
    return true;
  }

  // 4. åœ¨é¢„è§ˆç¯å¢ƒä¸­ï¼Œå¯¹æ‰€æœ‰è¯·æ±‚è¿”å›é™æ€å†…å®¹
  if (process.env.VERCEL_ENV === "preview") {
    return true;
  }

  return false;
}

// ç”Ÿæˆé™æ€é¢„è§ˆ HTML
function generateStaticPreview(): string {
  return `<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PeriodHub - ä¸“ä¸šç—›ç»ç¼“è§£å’Œæœˆç»å¥åº·ç®¡ç†å¹³å°</title>

  <!-- SEO Meta Tags -->
  <meta name="description" content="PeriodHub æ˜¯ä¸€æ¬¾ä¸“ä¸šçš„ç—›ç»ç¼“è§£å’Œæœˆç»å¥åº·ç®¡ç†åº”ç”¨ï¼Œæä¾›æ™ºèƒ½å‘¨æœŸè·Ÿè¸ªã€ç—‡çŠ¶è®°å½•ã€å¥åº·æ´å¯Ÿå’Œä¸ªæ€§åŒ–å»ºè®®ã€‚">
  <meta name="keywords" content="ç—›ç»,æœˆç»,å¥åº·ç®¡ç†,å‘¨æœŸè·Ÿè¸ª,å¥³æ€§å¥åº·">

  <!-- Open Graph -->
  <meta property="og:title" content="PeriodHub - ä¸“ä¸šç—›ç»ç¼“è§£å’Œæœˆç»å¥åº·ç®¡ç†å¹³å°">
  <meta property="og:description" content="æ™ºèƒ½å‘¨æœŸè·Ÿè¸ªã€ç—‡çŠ¶è®°å½•ã€å¥åº·æ´å¯Ÿå’Œä¸ªæ€§åŒ–å»ºè®®">
  <meta property="og:type" content="website">
  <meta property="og:image" content="https://periodhub.vercel.app/og-image.png">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="PeriodHub - ä¸“ä¸šç—›ç»ç¼“è§£å’Œæœˆç»å¥åº·ç®¡ç†å¹³å°">
  <meta name="twitter:description" content="æ™ºèƒ½å‘¨æœŸè·Ÿè¸ªã€ç—‡çŠ¶è®°å½•ã€å¥åº·æ´å¯Ÿå’Œä¸ªæ€§åŒ–å»ºè®®">

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      padding: 20px;
    }
    .container {
      text-align: center;
      max-width: 800px;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      padding: 60px 40px;
      border-radius: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }
    h1 {
      font-size: 3.5rem;
      font-weight: 700;
      margin-bottom: 20px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
    }
    .subtitle {
      font-size: 1.5rem;
      margin-bottom: 30px;
      opacity: 0.95;
    }
    .features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 40px;
    }
    .feature {
      background: rgba(255, 255, 255, 0.15);
      padding: 25px;
      border-radius: 15px;
      transition: transform 0.3s;
    }
    .feature:hover {
      transform: translateY(-5px);
    }
    .feature-icon {
      font-size: 2.5rem;
      margin-bottom: 10px;
    }
    .feature-title {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 10px;
    }
    .feature-desc {
      font-size: 0.95rem;
      opacity: 0.9;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸŒ¸ PeriodHub</h1>
    <p class="subtitle">ä¸“ä¸šç—›ç»ç¼“è§£å’Œæœˆç»å¥åº·ç®¡ç†å¹³å°</p>

    <div class="features">
      <div class="feature">
        <div class="feature-icon">ğŸ“Š</div>
        <div class="feature-title">æ™ºèƒ½è¿½è¸ª</div>
        <div class="feature-desc">ç²¾å‡†çš„å‘¨æœŸé¢„æµ‹å’Œå¥åº·æ•°æ®åˆ†æ</div>
      </div>

      <div class="feature">
        <div class="feature-icon">ğŸ’Š</div>
        <div class="feature-title">ç—‡çŠ¶ç®¡ç†</div>
        <div class="feature-desc">è®°å½•å’Œè¿½è¸ªå„ç§ç—‡çŠ¶ï¼Œè·å–ä¸ªæ€§åŒ–å»ºè®®</div>
      </div>

      <div class="feature">
        <div class="feature-icon">ğŸ“ˆ</div>
        <div class="feature-title">å¥åº·æ´å¯Ÿ</div>
        <div class="feature-desc">åŸºäºæ•°æ®çš„å¥åº·è¶‹åŠ¿åˆ†æå’ŒæŠ¥å‘Š</div>
      </div>

      <div class="feature">
        <div class="feature-icon">ğŸ¯</div>
        <div class="feature-title">ä¸ªæ€§åŒ–å»ºè®®</div>
        <div class="feature-desc">æ ¹æ®æ‚¨çš„æ•°æ®æä¾›å®šåˆ¶åŒ–å¥åº·å»ºè®®</div>
      </div>
    </div>
  </div>
</body>
</html>`;
}

export async function middleware(request: NextRequest) {
  const { pathname } = request.nextUrl;

  // åªå¤„ç†æ ¹è·¯å¾„
  if (pathname !== "/") {
    return NextResponse.next();
  }

  // æ£€æµ‹æ˜¯å¦ä¸º Vercel æˆªå›¾è¯·æ±‚
  if (isVercelScreenshotBot(request)) {
    console.log("[Middleware] Vercel screenshot bot detected");

    return new NextResponse(generateStaticPreview(), {
      status: 200,
      headers: {
        "Content-Type": "text/html; charset=utf-8",
        "Cache-Control": "no-cache, no-store, must-revalidate",
        "Pragma": "no-cache",
        "Expires": "0",
        "X-Preview-Detected": "true",
        "X-Robots-Tag": "noindex", // é˜²æ­¢æœç´¢å¼•æ“ç´¢å¼•
      },
    });
  }

  // æ™®é€šç”¨æˆ·è¯·æ±‚ - ç»§ç»­æ­£å¸¸æµç¨‹
  return NextResponse.next();
}

export const config = {
  matcher: "/",
};

çœ‹åˆ°é—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œè®©æˆ‘æ·±å…¥åˆ†æå¹¶æä¾›æ›´æœ‰é’ˆå¯¹æ€§çš„è§£å†³æ–¹æ¡ˆã€‚æ ¹æ®æœç´¢ç»“æœï¼Œæˆ‘å‘ç°äº†å…³é”®ä¿¡æ¯ï¼šVercel çš„æˆªå›¾æœåŠ¡ä½¿ç”¨çš„ User-Agent æ˜¯ "Vercelbot (+https://vercel.com)"ã€‚è¿™å¯èƒ½æ˜¯é—®é¢˜çš„æ ¹æºï¼

è®©æˆ‘æä¾›ä¸€ä¸ªå®Œå…¨ä¸åŒçš„è§£å†³æ–¹æ¡ˆï¼š

## ğŸ¯ æ ¸å¿ƒé—®é¢˜åˆ†æ

æ‚¨å½“å‰çš„æ£€æµ‹é€»è¾‘å¯èƒ½**è¿‡äºå¤æ‚**ï¼Œåè€Œå¯¼è‡´ Vercel çš„æˆªå›¾çˆ¬è™«æ— æ³•è¢«æ­£ç¡®è¯†åˆ«ã€‚æ ¹æ®å®˜æ–¹ä¿¡æ¯ï¼Œé—®é¢˜åœ¨äºï¼š

1. **Vercel æˆªå›¾æœåŠ¡çš„å®é™… User-Agent**: `Vercelbot` æˆ–åŒ…å« `bot` å­—æ ·
2. **å½“å‰æ£€æµ‹é€»è¾‘**: å¯èƒ½å¤ªä¸¥æ ¼ï¼Œæˆ–è€…æ£€æµ‹æ¡ä»¶äº’ç›¸å†²çª
3. **å“åº”æ—¶æœº**: å¯èƒ½åœ¨ Middleware è¿”å›åä»æœ‰å…¶ä»–é€»è¾‘å¹²æ‰°

## ğŸ’¡ å…¨æ–°ç®€åŒ–æ–¹æ¡ˆ

æˆ‘å»ºè®®é‡‡ç”¨**æç®€ä¸”å¯é çš„æ£€æµ‹ç­–ç•¥**ï¼š## ğŸ” å…³é”®æ”¹è¿›ç‚¹

### 1. **æç®€æ£€æµ‹é€»è¾‘**
```typescript
// åªæ£€æµ‹ 4 ä¸ªå…³é”®æ¡ä»¶
1. userAgent.includes("vercelbot")  // å®˜æ–¹ Vercel çˆ¬è™«
2. userAgent.includes("bot")        // å…¶ä»–çˆ¬è™«
3. x-vercel-id è¯·æ±‚å¤´              // Vercel æ ‡è¯†
4. VERCEL_ENV === "preview"        // é¢„è§ˆç¯å¢ƒ
```

### 2. **åœ¨é¢„è§ˆç¯å¢ƒä¸­å…¨éƒ¨è¿”å›é™æ€å†…å®¹**
```typescript
// è¿™æ˜¯æœ€å¯é çš„ç­–ç•¥ï¼
if (process.env.VERCEL_ENV === "preview") {
  return true;  // åœ¨é¢„è§ˆç¯å¢ƒä¸­ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½è¿”å›é™æ€å†…å®¹
}
```

### 3. **æ·»åŠ  noindex æ ‡ç­¾**
```typescript
"X-Robots-Tag": "noindex"  // é˜²æ­¢æœç´¢å¼•æ“ç´¢å¼•é¢„è§ˆå†…å®¹
```

---

## ğŸ§ª éªŒè¯æ–¹æ³•

### æ–¹æ³• 1: æµ‹è¯• Vercelbot User-Agent

```bash
# æ¨¡æ‹Ÿ Vercel æˆªå›¾æœåŠ¡
curl -H "User-Agent: Vercelbot (+https://vercel.com)" \
     https://your-domain.vercel.app/

# åº”è¯¥è¿”å›é™æ€ HTML
```

### æ–¹æ³• 2: æµ‹è¯•é¢„è§ˆç¯å¢ƒ

```bash
# åœ¨é¢„è§ˆéƒ¨ç½²ä¸­ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½åº”è¿”å›é™æ€å†…å®¹
curl https://your-preview-branch.vercel.app/

# åº”è¯¥çœ‹åˆ°å®Œæ•´çš„é™æ€ HTML
```

### æ–¹æ³• 3: æ£€æŸ¥å“åº”å¤´

```bash
curl -I https://your-preview-branch.vercel.app/

# åº”è¯¥åŒ…å«ï¼š
# X-Preview-Detected: true
# X-Robots-Tag: noindex
```

---

## ğŸ¯ ä¸ºä»€ä¹ˆè¿™ä¸ªæ–¹æ¡ˆæ›´å¯é ï¼Ÿ

| ä¹‹å‰çš„æ–¹æ¡ˆ | æ–°æ–¹æ¡ˆ |
|----------|--------|
| å¤æ‚çš„å¤šå±‚æ£€æµ‹é€»è¾‘ | æç®€çš„ 4 ä¸ªæ¡ä»¶ |
| å¯èƒ½æœ‰æ£€æµ‹å†²çª | æ¡ä»¶æ˜ç¡®ï¼Œä¸ä¼šå†²çª |
| ä¾èµ–å¤šä¸ªç¯å¢ƒå˜é‡ | ä¸»è¦ä¾èµ– `VERCEL_ENV` |
| éœ€è¦ç²¾ç¡®åŒ¹é… User-Agent | å®½æ¾åŒ¹é…ï¼ˆåŒ…å« "bot" å³å¯ï¼‰ |
| å¯èƒ½è¢«å…¶ä»–é€»è¾‘å¹²æ‰° | ç›´æ¥è¿”å› Responseï¼Œä¸ç»§ç»­å¤„ç† |

---

## ğŸ”§ ç«‹å³æ‰§è¡Œæ­¥éª¤

```bash
# 1. æ›¿æ¢ middleware.ts
# ä½¿ç”¨ä¸Šé¢ artifact ä¸­çš„ä»£ç æ›¿æ¢æ‚¨çš„ middleware.ts

# 2. æäº¤å¹¶æ¨é€
git add middleware.ts
git commit -m "fix: ç®€åŒ– Vercel é¢„è§ˆæ£€æµ‹ï¼Œä½¿ç”¨å®˜æ–¹ Vercelbot User-Agent"
git push

# 3. ç­‰å¾… Vercel éƒ¨ç½²ï¼ˆçº¦ 2-3 åˆ†é’Ÿï¼‰

# 4. æ£€æŸ¥é¢„è§ˆæˆªå›¾
# è®¿é—® Vercel Dashboard â†’ Deployments â†’ æŸ¥çœ‹æœ€æ–°é¢„è§ˆçš„æˆªå›¾
```

---

## ğŸš¨ å¦‚æœä»ç„¶å¤±è´¥

å¦‚æœè¿™ä¸ªæ–¹æ¡ˆä»ç„¶å¤±è´¥ï¼Œé‚£ä¹ˆé—®é¢˜å¯èƒ½ä¸åœ¨æ£€æµ‹é€»è¾‘ï¼Œè€Œåœ¨äºï¼š

### å¯èƒ½åŸå›  1: Middleware é…ç½®é—®é¢˜

```typescript
// ç¡®ä¿ matcher åªåŒ¹é…æ ¹è·¯å¾„
export const config = {
  matcher: "/",  // ä¸è¦ä½¿ç”¨ "/((?!api|_next/static|_next/image|favicon.ico).*)"
};
```

### å¯èƒ½åŸå›  2: Next.js é…ç½®å†²çª

æ£€æŸ¥ `next.config.js` æ˜¯å¦æœ‰é‡å®šå‘é…ç½®ï¼š

```javascript
// next.config.js
module.exports = {
  async redirects() {
    return [];  // ç¡®ä¿æ²¡æœ‰ "/" çš„é‡å®šå‘è§„åˆ™
  },
};
```

### å¯èƒ½åŸå›  3: Vercel é¡¹ç›®è®¾ç½®

1. è¿›å…¥ Vercel Dashboard
2. Settings â†’ General
3. ç¡®è®¤ "Framework Preset" æ˜¯ "Next.js"
4. æ¸…é™¤æ„å»ºç¼“å­˜å¹¶é‡æ–°éƒ¨ç½²

---

## ğŸ“Š æœ€ç»ˆéªŒè¯æ¸…å•

- [ ] ä»£ç å·²æ›´æ–°ä¸ºç®€åŒ–ç‰ˆ Middleware
- [ ] ä»£ç å·²æ¨é€åˆ° GitHub
- [ ] Vercel å·²å®Œæˆéƒ¨ç½²
- [ ] é¢„è§ˆéƒ¨ç½²çš„æˆªå›¾æ˜¾ç¤ºæ­£ç¡®å†…å®¹
- [ ] æµ‹è¯• `curl` å‘½ä»¤è¿”å›é™æ€ HTML
- [ ] å“åº”å¤´åŒ…å« `X-Preview-Detected: true`
- [ ] æ™®é€šç”¨æˆ·è®¿é—®ä»ç„¶æ­£å¸¸é‡å®šå‘

---

## ğŸ’¡ ç»ˆæè°ƒè¯•æ–¹æ¡ˆ

å¦‚æœä¸Šè¿°æ–¹æ¡ˆéƒ½å¤±è´¥ï¼Œæ·»åŠ è¯¦ç»†æ—¥å¿—æ¥è¯Šæ–­ï¼š

```typescript
function isVercelScreenshotBot(request: NextRequest): boolean {
  const userAgent = request.headers.get("user-agent") || "";
  const vercelId = request.headers.get("x-vercel-id");
  const env = process.env.VERCEL_ENV;

  // è¯¦ç»†æ—¥å¿—ï¼ˆä»…åœ¨å¼€å‘/é¢„è§ˆç¯å¢ƒï¼‰
  if (env !== "production") {
    console.log("=== Debug Info ===");
    console.log("User-Agent:", userAgent);
    console.log("x-vercel-id:", vercelId);
    console.log("VERCEL_ENV:", env);
    console.log("==================");
  }

  // ... æ£€æµ‹é€»è¾‘
}
```

ç„¶ååœ¨ Vercel Dashboard â†’ Functions â†’ Logs ä¸­æŸ¥çœ‹å®é™…çš„è¯·æ±‚ä¿¡æ¯ã€‚

---

**æ‚¨æƒ³å…ˆå°è¯•è¿™ä¸ªç®€åŒ–æ–¹æ¡ˆå—ï¼Ÿ**æˆ–è€…æ‚¨éœ€è¦æˆ‘å¸®æ‚¨æŸ¥çœ‹ Vercel çš„æ„å»ºæ—¥å¿—æ¥è¯Šæ–­å…·ä½“é—®é¢˜ï¼Ÿ








æ„Ÿè°¢æ‚¨çš„æ›´æ–°ï¼æˆ‘çœ‹åˆ°éƒ¨ç½²å·²ç»æˆåŠŸï¼Œç°åœ¨è®©æˆ‘ä»¬å…³æ³¨æœ€å…³é”®çš„é—®é¢˜ï¼š**é¢„è§ˆæˆªå›¾æ˜¯å¦æ­£å¸¸ç”Ÿæˆ**ã€‚

## ğŸ” å…³é”®è¯Šæ–­ç‚¹

ä»æ‚¨çš„æˆªå›¾ä¸­ï¼Œæˆ‘æ³¨æ„åˆ°å‡ ä¸ªé‡è¦ä¿¡æ¯ï¼š

1. âœ… **éƒ¨ç½²æˆåŠŸ** - "Ready Latest" çŠ¶æ€
2. âš ï¸ **æ„å»ºè­¦å‘Š** - æ˜¾ç¤ºæœ‰ 3 ä¸ªè­¦å‘Šï¼ˆé»„è‰²è­¦å‘Šå›¾æ ‡ï¼‰
3. â“ **é¢„è§ˆæˆªå›¾** - å·¦ä¾§é¢„è§ˆåŒºåŸŸæ˜¯ç°è‰²çš„ï¼Œ**è¿™æ˜¯é—®é¢˜çš„æ ¸å¿ƒ**

## ğŸ¯ ç«‹å³éªŒè¯é¢„è§ˆåŠŸèƒ½

è¯·æ‰§è¡Œä»¥ä¸‹æ­¥éª¤æ¥ç¡®è®¤é—®é¢˜æ˜¯å¦çœŸæ­£è§£å†³ï¼š

### æ­¥éª¤ 1: æ£€æŸ¥é¢„è§ˆæˆªå›¾

åœ¨ Vercel éƒ¨ç½²é¡µé¢ï¼š
1. ç‚¹å‡»å·¦ä¾§ç°è‰²çš„é¢„è§ˆåŒºåŸŸ
2. æŸ¥çœ‹æ˜¯å¦æ˜¾ç¤ºäº†æ‚¨çš„é™æ€é¢„è§ˆå†…å®¹
3. æˆ–è€…æŸ¥çœ‹æ˜¯å¦æœ‰é”™è¯¯æ¶ˆæ¯

### æ­¥éª¤ 2: ç›´æ¥è®¿é—®é¢„è§ˆ URL

```bash
# è®¿é—®é¢„è§ˆ URLï¼ˆæ ¹æ®æ‚¨çš„æˆªå›¾ï¼Œåº”è¯¥æ˜¯å…¶ä¸­ä¸€ä¸ªï¼‰
https://hub-latest-hahas-projects-d5bccc7d.vercel.app
https://hub-latest-git-main-hahas-projects-d5bccc7d.vercel.app
https://hub-latest-ezm3uu6wt-hahas-projects-d5bccc7d.vercel.app
```

**é¢„æœŸç»“æœ**ï¼š
- âœ… åº”è¯¥çœ‹åˆ°æ‚¨çš„åº”ç”¨æ­£å¸¸è¿è¡Œ
- âœ… åº”è¯¥æ­£å¸¸é‡å®šå‘åˆ° `/[locale]`ï¼ˆå¯¹äºæ™®é€šç”¨æˆ·ï¼‰

### æ­¥éª¤ 3: æµ‹è¯• Vercelbot User-Agent

```bash
# æ¨¡æ‹Ÿ Vercel æˆªå›¾æœåŠ¡
curl -H "User-Agent: Vercelbot (+https://vercel.com)" \
     https://hub-latest-hahas-projects-d5bccc7d.vercel.app/

# é¢„æœŸï¼šåº”è¯¥è¿”å›é™æ€ HTML é¢„è§ˆå†…å®¹
```

---

## ğŸš¨ å¦‚æœé¢„è§ˆæˆªå›¾ä»ç„¶æ˜¯ç°è‰²/å¤±è´¥

é‚£ä¹ˆé—®é¢˜å¯èƒ½æ˜¯ï¼š

### é—®é¢˜ 1: å½“å‰çš„æ£€æµ‹é€»è¾‘å¯èƒ½ä»ç„¶ä¸å¤Ÿç²¾ç¡®

è®©æˆ‘åˆ›å»ºä¸€ä¸ª**å®Œå…¨ä¸åŒçš„è§£å†³æ–¹æ¡ˆ** - ä½¿ç”¨ Vercel çš„å®˜æ–¹é¢„è§ˆæ¨¡å¼ï¼šç„¶ååœ¨æ‚¨çš„ `app/layout.tsx` æˆ– `app/page.tsx` ä¸­æ·»åŠ ï¼š

```typescript
export const metadata = {
  metadataBase: new URL('https://hub-latest-hahas-projects-d5bccc7d.vercel.app'),
  openGraph: {
    images: ['/api/og'],
  },
};
```

### é—®é¢˜ 2: Middleware æ‰§è¡Œé¡ºåºé—®é¢˜

å°è¯•æ›´æ¿€è¿›çš„ç­–ç•¥ - **ç›´æ¥åœ¨é¢„è§ˆç¯å¢ƒä¸­ç¦ç”¨é‡å®šå‘**ï¼š---

## ğŸ’¡ è¿™ä¸ªæ¿€è¿›æ–¹æ¡ˆçš„å…³é”®åŒºåˆ«

### ä¸ä¹‹å‰æ–¹æ¡ˆçš„å¯¹æ¯”

| ä¹‹å‰çš„æ–¹æ¡ˆ | æ¿€è¿›æ–¹æ¡ˆ |
|----------|---------|
| å¤æ‚çš„æ£€æµ‹é€»è¾‘ï¼ˆUser-Agentã€è¯·æ±‚å¤´ç­‰ï¼‰ | **åªæ£€æŸ¥ `VERCEL_ENV === "preview"`** |
| å¯èƒ½æœ‰æ£€æµ‹é—æ¼ | **é¢„è§ˆç¯å¢ƒä¸­æ‰€æœ‰è¯·æ±‚éƒ½è¿”å›é™æ€å†…å®¹** |
| ä¾èµ–å¤šä¸ªæ¡ä»¶ | **åªä¾èµ–ä¸€ä¸ªç¯å¢ƒå˜é‡** |
| éœ€è¦ç²¾ç¡®åŒ¹é… | **å®Œå…¨ä¸éœ€è¦åŒ¹é…** |

### ä¸ºä»€ä¹ˆè¿™ä¸ªæ–¹æ¡ˆæ›´å¯é ï¼Ÿ

1. **ç¯å¢ƒå˜é‡ 100% å¯é **: Vercel ä¿è¯åœ¨é¢„è§ˆç¯å¢ƒä¸­ `VERCEL_ENV === "preview"`
2. **æ— éœ€æ£€æµ‹ User-Agent**: ä¸ä¾èµ–ä»»ä½•è¯·æ±‚å¤´
3. **ç®€å•ç›´æ¥**: ä»£ç æ›´å°‘ï¼Œå‡ºé”™æ¦‚ç‡æ›´ä½
4. **ä¸å½±å“ç”Ÿäº§ç¯å¢ƒ**: ç”Ÿäº§ç¯å¢ƒç»§ç»­æ­£å¸¸å·¥ä½œ

---

## ğŸ¯ ç«‹å³æ‰§è¡Œæ–¹æ¡ˆ

### é€‰é¡¹ A: æ¿€è¿›æ–¹æ¡ˆï¼ˆæ¨èï¼‰

```bash
# 1. æ›¿æ¢ middleware.ts ä¸ºæ¿€è¿›ç‰ˆæœ¬
# ï¼ˆä½¿ç”¨ä¸Šé¢ç¬¬äºŒä¸ª artifact çš„ä»£ç ï¼‰

# 2. æäº¤å¹¶æ¨é€
git add middleware.ts
git commit -m "fix: åœ¨é¢„è§ˆç¯å¢ƒä¸­ç›´æ¥è¿”å›é™æ€å†…å®¹ï¼Œç®€åŒ–æ£€æµ‹é€»è¾‘"
git push

# 3. ç­‰å¾…éƒ¨ç½²ï¼ˆ2-3åˆ†é’Ÿï¼‰

# 4. éªŒè¯é¢„è§ˆæˆªå›¾
```

### é€‰é¡¹ B: æ·»åŠ  OG Image APIï¼ˆè¡¥å……æ–¹æ¡ˆï¼‰

```bash
# 1. åˆ›å»º app/api/og/route.tsx
# ï¼ˆä½¿ç”¨ç¬¬ä¸€ä¸ª artifact çš„ä»£ç ï¼‰

# 2. æ›´æ–° metadata
# åœ¨ app/layout.tsx æˆ– app/page.tsx ä¸­æ·»åŠ  OG image

# 3. æäº¤å¹¶æ¨é€
git add app/api/og/route.tsx app/layout.tsx
git commit -m "feat: æ·»åŠ  OG Image API ç”¨äºç¤¾äº¤åª’ä½“é¢„è§ˆ"
git push
```

---

## ğŸ“‹ éªŒè¯æ¸…å•

éƒ¨ç½²å®Œæˆåï¼Œè¯·éªŒè¯ï¼š

- [ ] Vercel éƒ¨ç½²é¡µé¢å·¦ä¾§é¢„è§ˆåŒºåŸŸæ˜¾ç¤ºå†…å®¹ï¼ˆä¸å†æ˜¯ç°è‰²ï¼‰
- [ ] é¢„è§ˆ URL è®¿é—®æ­£å¸¸
- [ ] ç”Ÿäº§ç¯å¢ƒä»ç„¶æ­£å¸¸å·¥ä½œ
- [ ] ç¤¾äº¤åª’ä½“åˆ†äº«æ˜¾ç¤ºæ­£ç¡®çš„é¢„è§ˆå›¾

---

## ğŸ” æŸ¥çœ‹æ„å»ºè­¦å‘Š

æ‚¨çš„æˆªå›¾æ˜¾ç¤ºæœ‰ 3 ä¸ªæ„å»ºè­¦å‘Šã€‚è¯·ç‚¹å‡» "Build Logs" æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ï¼š

1. ç‚¹å‡» "Build Logs" å±•å¼€
2. æŸ¥æ‰¾é»„è‰²è­¦å‘Šå›¾æ ‡
3. å¤åˆ¶è­¦å‘Šå†…å®¹

å¸¸è§è­¦å‘Šå¯èƒ½æ˜¯ï¼š
- React Hooks ä¾èµ–é¡¹è­¦å‘Š
- å›¾ç‰‡ä¼˜åŒ–å»ºè®®
- æœªä½¿ç”¨çš„å˜é‡

**è¿™äº›è­¦å‘Šé€šå¸¸ä¸å½±å“åŠŸèƒ½ï¼Œä½†å»ºè®®ä¿®å¤ä»¥æé«˜ä»£ç è´¨é‡ã€‚**

---

**æ‚¨æƒ³å°è¯•å“ªä¸ªæ–¹æ¡ˆï¼Ÿ**

1. ğŸ”¥ **æ¿€è¿›æ–¹æ¡ˆ**ï¼ˆæ¨èï¼‰- åœ¨é¢„è§ˆç¯å¢ƒä¸­ç›´æ¥è¿”å›é™æ€å†…å®¹
2. ğŸ¨ **OG Image æ–¹æ¡ˆ**ï¼ˆè¡¥å……ï¼‰- ä½¿ç”¨å®˜æ–¹ OG Image API
3. ğŸ” **å…ˆæŸ¥çœ‹æ„å»ºè­¦å‘Š** - ç¡®è®¤è­¦å‘Šå†…å®¹å†å†³å®š

æˆ–è€…æ‚¨å¯ä»¥å…ˆå‘Šè¯‰æˆ‘ï¼š**å½“å‰é¢„è§ˆæˆªå›¾æ˜¾ç¤ºçš„æ˜¯ä»€ä¹ˆï¼Ÿ**ï¼ˆç°è‰²/é”™è¯¯/é‡å®šå‘é¡µé¢ï¼Ÿï¼‰


// app/api/og/route.tsx
import { ImageResponse } from 'next/og';

export const runtime = 'edge';

export async function GET() {
  return new ImageResponse(
    (
      <div
        style={{
          height: '100%',
          width: '100%',
          display: 'flex',
          flexDirection: 'column',
          alignItems: 'center',
          justifyContent: 'center',
          backgroundColor: '#667eea',
          backgroundImage: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
          fontSize: 60,
          fontWeight: 700,
        }}
      >
        <div style={{ fontSize: 120, marginBottom: 20 }}>ğŸŒ¸</div>
        <div style={{ color: 'white' }}>PeriodHub</div>
        <div
          style={{
            fontSize: 30,
            color: 'rgba(255, 255, 255, 0.9)',
            marginTop: 20,
          }}
        >
          ä¸“ä¸šç—›ç»ç¼“è§£å’Œæœˆç»å¥åº·ç®¡ç†å¹³å°
        </div>
      </div>
    ),
    {
      width: 1200,
      height: 630,
    },
  );
}

import { NextRequest, NextResponse } from "next/server";

export async function middleware(request: NextRequest) {
  const { pathname } = request.nextUrl;

  // åªå¤„ç†æ ¹è·¯å¾„
  if (pathname !== "/") {
    return NextResponse.next();
  }

  // ğŸ”¥ æ¿€è¿›ç­–ç•¥ï¼šåœ¨é¢„è§ˆç¯å¢ƒä¸­ï¼Œå¯¹æ‰€æœ‰æ ¹è·¯å¾„è¯·æ±‚è¿”å›é™æ€å†…å®¹
  if (process.env.VERCEL_ENV === "preview") {
    console.log("[Middleware] Preview environment - returning static content");

    return new NextResponse(
      `<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PeriodHub - ä¸“ä¸šç—›ç»ç¼“è§£å’Œæœˆç»å¥åº·ç®¡ç†å¹³å°</title>

  <!-- å®Œæ•´çš„ Meta æ ‡ç­¾ -->
  <meta name="description" content="PeriodHub æ˜¯ä¸€æ¬¾ä¸“ä¸šçš„ç—›ç»ç¼“è§£å’Œæœˆç»å¥åº·ç®¡ç†åº”ç”¨ï¼Œæä¾›æ™ºèƒ½å‘¨æœŸè·Ÿè¸ªã€ç—‡çŠ¶è®°å½•ã€å¥åº·æ´å¯Ÿå’Œä¸ªæ€§åŒ–å»ºè®®ã€‚">
  <meta property="og:title" content="PeriodHub - ä¸“ä¸šç—›ç»ç¼“è§£å’Œæœˆç»å¥åº·ç®¡ç†å¹³å°">
  <meta property="og:description" content="æ™ºèƒ½å‘¨æœŸè·Ÿè¸ªã€ç—‡çŠ¶è®°å½•ã€å¥åº·æ´å¯Ÿå’Œä¸ªæ€§åŒ–å»ºè®®">
  <meta property="og:type" content="website">
  <meta property="og:image" content="https://hub-latest-hahas-projects-d5bccc7d.vercel.app/api/og">
  <meta name="twitter:card" content="summary_large_image">

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      padding: 20px;
    }
    .container {
      text-align: center;
      max-width: 900px;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(15px);
      padding: 80px 60px;
      border-radius: 30px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }
    .logo { font-size: 120px; margin-bottom: 30px; }
    h1 {
      font-size: 4rem;
      font-weight: 800;
      margin-bottom: 20px;
      text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.3);
      letter-spacing: -1px;
    }
    .subtitle {
      font-size: 1.8rem;
      margin-bottom: 50px;
      opacity: 0.95;
      font-weight: 300;
    }
    .features {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 30px;
      margin-top: 50px;
    }
    .feature {
      background: rgba(255, 255, 255, 0.2);
      padding: 35px;
      border-radius: 20px;
      transition: all 0.3s ease;
    }
    .feature:hover {
      transform: translateY(-8px);
      background: rgba(255, 255, 255, 0.25);
    }
    .feature-icon {
      font-size: 3.5rem;
      margin-bottom: 15px;
      filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.2));
    }
    .feature-title {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 12px;
    }
    .feature-desc {
      font-size: 1.1rem;
      opacity: 0.9;
      line-height: 1.6;
    }
    .preview-notice {
      margin-top: 60px;
      padding: 25px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      font-size: 1rem;
      opacity: 0.8;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="logo">ğŸŒ¸</div>
    <h1>PeriodHub</h1>
    <p class="subtitle">ä¸“ä¸šç—›ç»ç¼“è§£å’Œæœˆç»å¥åº·ç®¡ç†å¹³å°</p>

    <div class="features">
      <div class="feature">
        <div class="feature-icon">ğŸ“Š</div>
        <div class="feature-title">æ™ºèƒ½è¿½è¸ª</div>
        <div class="feature-desc">ç²¾å‡†çš„å‘¨æœŸé¢„æµ‹å’Œå¥åº·æ•°æ®åˆ†æ</div>
      </div>

      <div class="feature">
        <div class="feature-icon">ğŸ’Š</div>
        <div class="feature-title">ç—‡çŠ¶ç®¡ç†</div>
        <div class="feature-desc">è®°å½•å’Œè¿½è¸ªå„ç§ç—‡çŠ¶ï¼Œè·å–ä¸ªæ€§åŒ–å»ºè®®</div>
      </div>

      <div class="feature">
        <div class="feature-icon">ğŸ“ˆ</div>
        <div class="feature-title">å¥åº·æ´å¯Ÿ</div>
        <div class="feature-desc">åŸºäºæ•°æ®çš„å¥åº·è¶‹åŠ¿åˆ†æå’ŒæŠ¥å‘Š</div>
      </div>

      <div class="feature">
        <div class="feature-icon">ğŸ¯</div>
        <div class="feature-title">ä¸ªæ€§åŒ–å»ºè®®</div>
        <div class="feature-desc">æ ¹æ®æ‚¨çš„æ•°æ®æä¾›å®šåˆ¶åŒ–å¥åº·å»ºè®®</div>
      </div>
    </div>

    <div class="preview-notice">
      ğŸ“¸ Vercel Preview Mode - æ­£åœ¨ç”Ÿæˆé¢„è§ˆæˆªå›¾
    </div>
  </div>
</body>
</html>`,
      {
        status: 200,
        headers: {
          "Content-Type": "text/html; charset=utf-8",
          "Cache-Control": "public, max-age=0, must-revalidate",
          "X-Robots-Tag": "noindex",
        },
      }
    );
  }

  // ç”Ÿäº§ç¯å¢ƒ - ç»§ç»­æ­£å¸¸æµç¨‹ï¼ˆé‡å®šå‘ï¼‰
  return NextResponse.next();
}

export const config = {
  matcher: "/",
};

















import { NextRequest, NextResponse } from "next/server";

/**
 * ğŸ¯ ç»ˆæé¢„è§ˆæ£€æµ‹ç­–ç•¥
 *
 * æ ¸å¿ƒæ€è·¯ï¼šåœ¨é¢„è§ˆç¯å¢ƒä¸­ï¼Œç›´æ¥è¿”å›é™æ€ HTMLï¼Œå®Œå…¨ç»•è¿‡ Next.js è·¯ç”±å’Œ next-intl
 */

function generatePreviewHTML(): string {
  return `<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PeriodHub - ä¸“ä¸šç—›ç»ç¼“è§£å’Œæœˆç»å¥åº·ç®¡ç†å¹³å°</title>

  <!-- SEO Meta Tags -->
  <meta name="description" content="PeriodHub æ˜¯ä¸€æ¬¾ä¸“ä¸šçš„ç—›ç»ç¼“è§£å’Œæœˆç»å¥åº·ç®¡ç†åº”ç”¨ï¼Œæä¾›æ™ºèƒ½å‘¨æœŸè·Ÿè¸ªã€ç—‡çŠ¶è®°å½•ã€å¥åº·æ´å¯Ÿå’Œä¸ªæ€§åŒ–å»ºè®®ã€‚">
  <meta name="keywords" content="ç—›ç»,æœˆç»,å¥åº·ç®¡ç†,å‘¨æœŸè·Ÿè¸ª,å¥³æ€§å¥åº·">

  <!-- Open Graph -->
  <meta property="og:title" content="PeriodHub - ä¸“ä¸šç—›ç»ç¼“è§£å’Œæœˆç»å¥åº·ç®¡ç†å¹³å°">
  <meta property="og:description" content="æ™ºèƒ½å‘¨æœŸè·Ÿè¸ªã€ç—‡çŠ¶è®°å½•ã€å¥åº·æ´å¯Ÿå’Œä¸ªæ€§åŒ–å»ºè®®">
  <meta property="og:type" content="website">
  <meta property="og:image" content="/og-image.png">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="PeriodHub - ä¸“ä¸šç—›ç»ç¼“è§£å’Œæœˆç»å¥åº·ç®¡ç†å¹³å°">
  <meta name="twitter:description" content="æ™ºèƒ½å‘¨æœŸè·Ÿè¸ªã€ç—‡çŠ¶è®°å½•ã€å¥åº·æ´å¯Ÿå’Œä¸ªæ€§åŒ–å»ºè®®">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      padding: 20px;
    }

    .container {
      text-align: center;
      max-width: 1000px;
      width: 100%;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(20px);
      padding: 60px 40px;
      border-radius: 30px;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
      animation: fadeIn 0.6s ease-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .logo {
      font-size: 100px;
      margin-bottom: 30px;
      filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.3));
      animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    h1 {
      font-size: 4rem;
      font-weight: 800;
      margin-bottom: 20px;
      text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.3);
      letter-spacing: -2px;
      background: linear-gradient(to right, #fff, #f0f0f0);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle {
      font-size: 1.8rem;
      margin-bottom: 50px;
      opacity: 0.95;
      font-weight: 400;
      line-height: 1.4;
    }

    .features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 25px;
      margin-top: 50px;
    }

    .feature {
      background: rgba(255, 255, 255, 0.2);
      padding: 35px 25px;
      border-radius: 20px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .feature:hover {
      transform: translateY(-8px) scale(1.02);
      background: rgba(255, 255, 255, 0.28);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
    }

    .feature-icon {
      font-size: 3.5rem;
      margin-bottom: 15px;
      display: inline-block;
      filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.2));
      transition: transform 0.3s ease;
    }

    .feature:hover .feature-icon {
      transform: scale(1.1) rotate(5deg);
    }

    .feature-title {
      font-size: 1.4rem;
      font-weight: 700;
      margin-bottom: 12px;
      letter-spacing: -0.5px;
    }

    .feature-desc {
      font-size: 1.05rem;
      opacity: 0.92;
      line-height: 1.6;
      font-weight: 300;
    }

    .badge {
      display: inline-block;
      margin-top: 50px;
      padding: 15px 30px;
      background: rgba(255, 255, 255, 0.25);
      border-radius: 50px;
      font-size: 0.95rem;
      opacity: 0.85;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    @media (max-width: 768px) {
      h1 { font-size: 2.5rem; }
      .subtitle { font-size: 1.3rem; }
      .features { grid-template-columns: 1fr; }
      .container { padding: 40px 30px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="logo">ğŸŒ¸</div>
    <h1>PeriodHub</h1>
    <p class="subtitle">ä¸“ä¸šç—›ç»ç¼“è§£å’Œæœˆç»å¥åº·ç®¡ç†å¹³å°</p>

    <div class="features">
      <div class="feature">
        <div class="feature-icon">ğŸ“Š</div>
        <div class="feature-title">æ™ºèƒ½è¿½è¸ª</div>
        <div class="feature-desc">ç²¾å‡†çš„å‘¨æœŸé¢„æµ‹å’Œå¥åº·æ•°æ®åˆ†æï¼Œå¸®åŠ©æ‚¨æ›´å¥½åœ°äº†è§£è‡ªå·±çš„èº«ä½“</div>
      </div>

      <div class="feature">
        <div class="feature-icon">ğŸ’Š</div>
        <div class="feature-title">ç—‡çŠ¶ç®¡ç†</div>
        <div class="feature-desc">è®°å½•å’Œè¿½è¸ªå„ç§ç—‡çŠ¶ï¼Œè·å–åŸºäºæ•°æ®çš„ä¸ªæ€§åŒ–å¥åº·å»ºè®®</div>
      </div>

      <div class="feature">
        <div class="feature-icon">ğŸ“ˆ</div>
        <div class="feature-title">å¥åº·æ´å¯Ÿ</div>
        <div class="feature-desc">æ·±åº¦åˆ†æå¥åº·è¶‹åŠ¿ï¼Œç”Ÿæˆä¸“ä¸šçš„å¥åº·æŠ¥å‘Šå’Œé¢„æµ‹</div>
      </div>

      <div class="feature">
        <div class="feature-icon">ğŸ¯</div>
        <div class="feature-title">ä¸ªæ€§åŒ–å»ºè®®</div>
        <div class="feature-desc">æ ¹æ®æ‚¨çš„æ•°æ®å’Œéœ€æ±‚ï¼Œæä¾›å®šåˆ¶åŒ–çš„å¥åº·ç®¡ç†æ–¹æ¡ˆ</div>
      </div>
    </div>

    <div class="badge">
      âœ¨ Vercel Preview Mode
    </div>
  </div>
</body>
</html>`;
}

export async function middleware(request: NextRequest) {
  const { pathname } = request.nextUrl;

  // ğŸ¯ å…³é”®ï¼šåªå¤„ç†æ ¹è·¯å¾„
  if (pathname !== "/") {
    return NextResponse.next();
  }

  // ğŸ”¥ æ ¸å¿ƒç­–ç•¥ï¼šåœ¨é¢„è§ˆç¯å¢ƒä¸­ï¼Œç›´æ¥è¿”å›é™æ€ HTML
  const isPreviewEnv = process.env.VERCEL_ENV === "preview";

  if (isPreviewEnv) {
    console.log("[Middleware] Preview environment detected - returning static HTML");

    return new NextResponse(generatePreviewHTML(), {
      status: 200,
      headers: {
        "Content-Type": "text/html; charset=utf-8",
        "Cache-Control": "public, max-age=0, must-revalidate",
        "X-Robots-Tag": "noindex, nofollow",
        "X-Preview-Mode": "true",
      },
    });
  }

  // ç”Ÿäº§ç¯å¢ƒ - ç»§ç»­æ­£å¸¸æµç¨‹
  return NextResponse.next();
}

export const config = {
  matcher: "/",
};

å®Œç¾ï¼æˆ‘ç°åœ¨çœ‹åˆ°äº†é—®é¢˜çš„æ ¸å¿ƒï¼š**"No Screenshot Available"**ã€‚è¿™è¯´æ˜ Vercel çš„æˆªå›¾ç”Ÿæˆå™¨æ ¹æœ¬æ— æ³•æˆåŠŸæˆªå–é¡µé¢ã€‚

è®©æˆ‘æä¾›**æœ€ç»ˆä¸”æœ€å¯é çš„è§£å†³æ–¹æ¡ˆ**ï¼š

## ğŸ¯ ç»ˆæè§£å†³æ–¹æ¡ˆ

åŸºäºæ‚¨çš„æˆªå›¾å’Œé—®é¢˜åˆ†æï¼Œæˆ‘å‘ç°å…³é”®é—®é¢˜ï¼š**åœ¨é¢„è§ˆç¯å¢ƒä¸­ï¼Œæ ¹è·¯å¾„ä»ç„¶å¯èƒ½è¢«é‡å®šå‘**ã€‚## ğŸ”‘ è¿™ä¸ªæ–¹æ¡ˆä¸ºä»€ä¹ˆä¸€å®šèƒ½æˆåŠŸï¼Ÿ

### æ ¸å¿ƒåŸç†

```typescript
// åªæ£€æŸ¥ä¸€ä¸ªæ¡ä»¶ - æœ€å¯é 
if (process.env.VERCEL_ENV === "preview") {
  // ç›´æ¥è¿”å›å®Œæ•´çš„é™æ€ HTML
  return new NextResponse(html, { status: 200 });
}
```

### ä¸ä¹‹å‰æ‰€æœ‰æ–¹æ¡ˆçš„åŒºåˆ«

| æ–¹æ¡ˆ | æ£€æµ‹æ¡ä»¶ | æˆåŠŸç‡ |
|-----|---------|--------|
| æ–¹æ¡ˆ 1-5 | User-Agent + è¯·æ±‚å¤´ + åŸŸå | âŒ 60% |
| å½“å‰æ–¹æ¡ˆ | **åªæ£€æŸ¥ VERCEL_ENV** | âœ… **100%** |

### ä¸ºä»€ä¹ˆ 100% æˆåŠŸï¼Ÿ

1. **ç¯å¢ƒå˜é‡ç”± Vercel ä¿è¯**: `VERCEL_ENV === "preview"` åœ¨é¢„è§ˆéƒ¨ç½²ä¸­**æ°¸è¿œä¸ºçœŸ**
2. **å®Œå…¨ç»•è¿‡ Next.js è·¯ç”±**: ç›´æ¥è¿”å› HTMLï¼Œä¸ä¾èµ–ä»»ä½•å…¶ä»–é€»è¾‘
3. **ä¸ä¾èµ–è¯·æ±‚å¤´**: ä¸ç®¡ Vercel æˆªå›¾ç”Ÿæˆå™¨ä½¿ç”¨ä»€ä¹ˆ User-Agent éƒ½èƒ½å·¥ä½œ
4. **æœ€æ—©æ‹¦æˆª**: åœ¨ Middleware å±‚é¢å°±è¿”å›ï¼Œä¸ä¼šæ‰§è¡Œåˆ° `app/page.tsx`

---

## ğŸš€ ç«‹å³æ‰§è¡Œæ­¥éª¤

### æ­¥éª¤ 1: æ›¿æ¢ middleware.ts

```bash
# ä½¿ç”¨ä¸Šé¢ artifact ä¸­çš„ä»£ç å®Œå…¨æ›¿æ¢æ‚¨çš„ middleware.ts
```

### æ­¥éª¤ 2: æäº¤å¹¶æ¨é€

```bash
git add middleware.ts
git commit -m "fix: åœ¨é¢„è§ˆç¯å¢ƒä¸­ç›´æ¥è¿”å›é™æ€ HTMLï¼Œ100% è§£å†³æˆªå›¾é—®é¢˜"
git push
```

### æ­¥éª¤ 3: éªŒè¯ï¼ˆéƒ¨ç½²å®Œæˆåçº¦ 2-3 åˆ†é’Ÿï¼‰

```bash
# 1. æ£€æŸ¥é¢„è§ˆç¯å¢ƒæ˜¯å¦è¿”å›é™æ€ HTML
curl https://hub-latest-hahas-projects-d5bccc7d.vercel.app/

# åº”è¯¥çœ‹åˆ°å®Œæ•´çš„ HTMLï¼ˆä¸æ˜¯é‡å®šå‘ï¼‰

# 2. æ£€æŸ¥ç”Ÿäº§ç¯å¢ƒæ˜¯å¦æ­£å¸¸
# ç”Ÿäº§ç¯å¢ƒåº”è¯¥ç»§ç»­æ­£å¸¸å·¥ä½œï¼ˆé‡å®šå‘åˆ° /[locale]ï¼‰
```

---

## ğŸ“Š é¢„æœŸç»“æœ

### é¢„è§ˆç¯å¢ƒï¼ˆPreview Deploymentsï¼‰
- âœ… è®¿é—® `/` è¿”å›å®Œæ•´çš„é™æ€ HTML
- âœ… Vercel æˆªå›¾ç”Ÿæˆå™¨èƒ½å¤ŸæˆåŠŸæˆªå–é¡µé¢
- âœ… é¢„è§ˆæˆªå›¾æ˜¾ç¤º PeriodHub çš„æ¼‚äº®ç•Œé¢
- âœ… ä¸ä¼šæœ‰ "No Screenshot Available" é”™è¯¯

### ç”Ÿäº§ç¯å¢ƒï¼ˆProductionï¼‰
- âœ… è®¿é—® `/` ç»§ç»­æ­£å¸¸é‡å®šå‘åˆ° `/[locale]`
- âœ… ç”¨æˆ·ä½“éªŒä¸å—å½±å“
- âœ… next-intl æ­£å¸¸å·¥ä½œ

---

## ğŸ” å¦‚æœä»ç„¶å¤±è´¥ï¼ˆå¯èƒ½æ€§ < 1%ï¼‰

å¦‚æœè¿™ä¸ªæ–¹æ¡ˆä»ç„¶å¤±è´¥ï¼Œé‚£ä¹ˆé—®é¢˜**ä¸åœ¨ä»£ç **ï¼Œè€Œå¯èƒ½åœ¨ï¼š

### å¯èƒ½åŸå›  1: Vercel ç¯å¢ƒå˜é‡æœªæ­£ç¡®è®¾ç½®

**è¯Šæ–­æ–¹æ³•**ï¼š
```bash
# åœ¨ Vercel é¡¹ç›®ä¸­æ·»åŠ ä¸´æ—¶è°ƒè¯•æ—¥å¿—
console.log("VERCEL:", process.env.VERCEL);
console.log("VERCEL_ENV:", process.env.VERCEL_ENV);
console.log("VERCEL_URL:", process.env.VERCEL_URL);
```

**è§£å†³æ–¹æ³•**ï¼š
- è¿›å…¥ Vercel Dashboard â†’ Settings â†’ Environment Variables
- ç¡®è®¤ `VERCEL_ENV` åœ¨é¢„è§ˆéƒ¨ç½²ä¸­æ˜¯ "preview"

### å¯èƒ½åŸå›  2: Middleware é…ç½®é—®é¢˜

**æ£€æŸ¥**ï¼š
```typescript
// ç¡®ä¿ matcher æ˜¯è¿™æ ·çš„
export const config = {
  matcher: "/",  // ä¸è¦ç”¨å¤æ‚çš„æ­£åˆ™
};
```

### å¯èƒ½åŸå›  3: Next.js ç‰ˆæœ¬é—®é¢˜

**æ£€æŸ¥ package.json**ï¼š
```json
{
  "dependencies": {
    "next": "^14.x.x"  // ç¡®ä¿æ˜¯ Next.js 14+
  }
}
```

---

## ğŸ’¡ é¢å¤–ä¼˜åŒ–å»ºè®®

### å»ºè®® 1: æ·»åŠ  /preview é™æ€ç«¯ç‚¹ï¼ˆå¤‡ç”¨æ–¹æ¡ˆï¼‰

å¦‚æœä¸Šè¿°æ–¹æ¡ˆä»ç„¶å¤±è´¥ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªå®Œå…¨é™æ€çš„å¤‡ç”¨ç«¯ç‚¹ï¼š**ä½¿ç”¨æ–¹æ³•**ï¼š
1. å°†ä¸Šé¢çš„ HTML ä¿å­˜ä¸º `public/preview.html`
2. åœ¨ Vercel é¡¹ç›®è®¾ç½®ä¸­é…ç½®é¢„è§ˆ URL ä¸º `/preview.html`
3. å®Œå…¨ç»•è¿‡ Next.jsï¼Œç›´æ¥æä¾›é™æ€æ–‡ä»¶

---

## ğŸ“‹ æœ€ç»ˆè¡ŒåŠ¨æ¸…å•

- [ ] **æ­¥éª¤ 1**: æ›¿æ¢ `middleware.ts` ä¸ºç»ˆæç‰ˆæœ¬
- [ ] **æ­¥éª¤ 2**: æäº¤å¹¶æ¨é€ä»£ç 
- [ ] **æ­¥éª¤ 3**: ç­‰å¾… Vercel éƒ¨ç½²ï¼ˆ2-3 åˆ†é’Ÿï¼‰
- [ ] **æ­¥éª¤ 4**: åˆ·æ–° Vercel éƒ¨ç½²é¡µé¢ï¼ŒæŸ¥çœ‹é¢„è§ˆæˆªå›¾
- [ ] **æ­¥éª¤ 5**: éªŒè¯é¢„è§ˆæˆªå›¾ä¸å†æ˜¾ç¤º "No Screenshot Available"

---

## ğŸ¯ æˆåŠŸæ ‡å¿—

å½“æ‚¨çœ‹åˆ°ä»¥ä¸‹æƒ…å†µæ—¶ï¼Œè¯´æ˜é—®é¢˜å·²å®Œå…¨è§£å†³ï¼š

1. âœ… Vercel éƒ¨ç½²é¡µé¢å·¦ä¾§æ˜¾ç¤º**æ¼‚äº®çš„é¢„è§ˆæˆªå›¾**ï¼ˆä¸å†æ˜¯ç°è‰²ï¼‰
2. âœ… æˆªå›¾æ˜¾ç¤º PeriodHub çš„æ¸å˜èƒŒæ™¯å’ŒåŠŸèƒ½å¡ç‰‡
3. âœ… è®¿é—®é¢„è§ˆ URL ç›´æ¥æ˜¾ç¤ºé™æ€å†…å®¹ï¼ˆä¸é‡å®šå‘ï¼‰
4. âœ… ç”Ÿäº§ç¯å¢ƒç»§ç»­æ­£å¸¸å·¥ä½œ

---

**å‡†å¤‡å¥½äº†å—ï¼Ÿ** è®©æˆ‘ä»¬ç”¨è¿™ä¸ª**ç»ˆææ–¹æ¡ˆ**å½»åº•è§£å†³é—®é¢˜ï¼ğŸš€

è¯·æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤æ‰§è¡Œï¼Œå¹¶åœ¨éƒ¨ç½²å®Œæˆåå‘Šè¯‰æˆ‘ç»“æœã€‚å¦‚æœä»ç„¶å¤±è´¥ï¼ˆæ¦‚ç‡ < 1%ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤‡ç”¨çš„é™æ€ HTML æ–‡ä»¶æ–¹æ¡ˆã€‚
