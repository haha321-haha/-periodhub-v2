<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workplace Wellness å­˜å‚¨æµ‹è¯•å·¥å…·</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
        }
        h1 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 28px;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        .test-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }
        .test-section h2 {
            color: #333;
            font-size: 18px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .test-section p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 15px;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        button.secondary {
            background: #6c757d;
        }
        button.danger {
            background: #dc3545;
        }
        button.success {
            background: #28a745;
        }
        .result {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .result.success {
            border-color: #28a745;
            background: #d4edda;
            color: #155724;
        }
        .result.error {
            border-color: #dc3545;
            background: #f8d7da;
            color: #721c24;
        }
        .result.info {
            border-color: #17a2b8;
            background: #d1ecf1;
            color: #0c5460;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
            text-align: center;
        }
        .stat-card .value {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }
        .stat-card .label {
            font-size: 14px;
            color: #666;
        }
        .icon {
            font-size: 20px;
        }
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }
        .badge.pass {
            background: #28a745;
            color: white;
        }
        .badge.fail {
            background: #dc3545;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Workplace Wellness å­˜å‚¨ä¼˜åŒ–æµ‹è¯•å·¥å…·</h1>
        <p class="subtitle">å¿«é€ŸéªŒè¯æ•°æ®æ¸…ç†å’Œå­˜å‚¨è­¦å‘ŠåŠŸèƒ½</p>

        <!-- æµ‹è¯•1: æ£€æŸ¥å­˜å‚¨çŠ¶æ€ -->
        <div class="test-section">
            <h2><span class="icon">ğŸ“Š</span> æµ‹è¯•1: æ£€æŸ¥å½“å‰å­˜å‚¨çŠ¶æ€</h2>
            <p>æŸ¥çœ‹å½“å‰ localStorage ä¸­çš„æ•°æ®é‡å’Œå¤§å°</p>
            <button onclick="checkStorageStatus()">æ£€æŸ¥å­˜å‚¨çŠ¶æ€</button>
            <div id="storage-result"></div>
        </div>

        <!-- æµ‹è¯•2: æ¨¡æ‹Ÿå­˜å‚¨æ»¡ -->
        <div class="test-section">
            <h2><span class="icon">âš ï¸</span> æµ‹è¯•2: æ¨¡æ‹Ÿå­˜å‚¨ç©ºé—´æ»¡</h2>
            <p>è§¦å‘ storage-warning äº‹ä»¶ï¼ŒéªŒè¯æç¤ºæ¡†æ˜¯å¦æ˜¾ç¤º</p>
            <button onclick="triggerStorageWarning('sessionStorage')">è§¦å‘ sessionStorage è­¦å‘Šï¼ˆé»„è‰²ï¼‰</button>
            <button class="danger" onclick="triggerStorageWarning('failed')">è§¦å‘ failed è­¦å‘Šï¼ˆçº¢è‰²ï¼‰</button>
            <div id="warning-result"></div>
        </div>

        <!-- æµ‹è¯•3: æ¸…ç©ºæ•°æ® -->
        <div class="test-section">
            <h2><span class="icon">ğŸ—‘ï¸</span> æµ‹è¯•3: æ¸…ç©ºæ‰€æœ‰æ•°æ®</h2>
            <p>æ¸…ç©º localStorageï¼Œå‡†å¤‡è¿›è¡Œæ–°çš„æµ‹è¯•</p>
            <button class="danger" onclick="clearAllData()">æ¸…ç©º localStorage</button>
            <div id="clear-result"></div>
        </div>

        <!-- æµ‹è¯•4: ç”Ÿæˆæµ‹è¯•æ•°æ® -->
        <div class="test-section">
            <h2><span class="icon">ğŸ“</span> æµ‹è¯•4: ç”Ÿæˆæµ‹è¯•æ•°æ®</h2>
            <p>è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•æ•°æ®ï¼ŒéªŒè¯è‡ªåŠ¨æ¸…ç†åŠŸèƒ½</p>
            <button onclick="generateTestData(10)">ç”Ÿæˆ 10 æ¡è®°å½•</button>
            <button onclick="generateTestData(25)">ç”Ÿæˆ 25 æ¡è®°å½•</button>
            <button class="secondary" onclick="generateTestData(50)">ç”Ÿæˆ 50 æ¡è®°å½•ï¼ˆæµ‹è¯•æ¸…ç†ï¼‰</button>
            <div id="generate-result"></div>
        </div>

        <!-- æµ‹è¯•5: éªŒè¯æ•°æ®æ¸…ç† -->
        <div class="test-section">
            <h2><span class="icon">âœ…</span> æµ‹è¯•5: éªŒè¯æ•°æ®æ¸…ç†è§„åˆ™</h2>
            <p>æ£€æŸ¥æ•°æ®æ˜¯å¦æŒ‰ç…§ 2å‘¨+20æ¡ çš„è§„åˆ™è¢«æ¸…ç†</p>
            <button class="success" onclick="verifyDataCleanup()">éªŒè¯æ¸…ç†è§„åˆ™</button>
            <div id="verify-result"></div>
        </div>

        <!-- æµ‹è¯•6: å®Œæ•´æµ‹è¯• -->
        <div class="test-section">
            <h2><span class="icon">ğŸ¯</span> æµ‹è¯•6: è‡ªåŠ¨åŒ–å®Œæ•´æµ‹è¯•</h2>
            <p>è‡ªåŠ¨æ‰§è¡Œæ‰€æœ‰æµ‹è¯•æ­¥éª¤ï¼Œç”Ÿæˆå®Œæ•´æŠ¥å‘Š</p>
            <button class="success" onclick="runFullTest()">è¿è¡Œå®Œæ•´æµ‹è¯•</button>
            <div id="full-test-result"></div>
        </div>

        <!-- ç»Ÿè®¡æ•°æ® -->
        <div class="stats">
            <div class="stat-card">
                <div class="value" id="stat-records">-</div>
                <div class="label">å½“å‰è®°å½•æ•°</div>
            </div>
            <div class="stat-card">
                <div class="value" id="stat-size">-</div>
                <div class="label">å­˜å‚¨å¤§å° (KB)</div>
            </div>
            <div class="stat-card">
                <div class="value" id="stat-exports">-</div>
                <div class="label">å¯¼å‡ºå†å²</div>
            </div>
            <div class="stat-card">
                <div class="value" id="stat-feedbacks">-</div>
                <div class="label">åé¦ˆæ•°é‡</div>
            </div>
        </div>
    </div>

    <script>
        // æ›´æ–°ç»Ÿè®¡æ•°æ®
        function updateStats() {
            try {
                const data = JSON.parse(localStorage.getItem('workplace-wellness-storage') || '{}');
                const state = data?.state || {};
                
                document.getElementById('stat-records').textContent = 
                    state?.calendar?.periodData?.length || 0;
                
                const sizeBytes = localStorage.getItem('workplace-wellness-storage')?.length || 0;
                document.getElementById('stat-size').textContent = 
                    (sizeBytes / 1024).toFixed(2);
                
                document.getElementById('stat-exports').textContent = 
                    state?.exportHistory?.length || 0;
                
                document.getElementById('stat-feedbacks').textContent = 
                    state?.recommendationFeedback?.feedbacks?.length || 0;
            } catch (e) {
                console.error('Failed to update stats:', e);
            }
        }

        // æ£€æŸ¥å­˜å‚¨çŠ¶æ€
        function checkStorageStatus() {
            const result = document.getElementById('storage-result');
            try {
                const data = JSON.parse(localStorage.getItem('workplace-wellness-storage') || '{}');
                const state = data?.state || {};
                const sizeBytes = localStorage.getItem('workplace-wellness-storage')?.length || 0;
                const sizeKB = (sizeBytes / 1024).toFixed(2);
                
                const records = state?.calendar?.periodData || [];
                const twoWeeksAgo = new Date();
                twoWeeksAgo.setDate(twoWeeksAgo.getDate() - 14);
                
                const recordsInTwoWeeks = records.filter(r => {
                    try {
                        return new Date(r.date) >= twoWeeksAgo;
                    } catch {
                        return false;
                    }
                }).length;
                
                result.className = 'result info';
                result.innerHTML = `
                    <strong>âœ… å­˜å‚¨çŠ¶æ€æ£€æŸ¥å®Œæˆ</strong><br><br>
                    ğŸ“Š å­˜å‚¨å¤§å°: ${sizeKB} KB ${sizeKB < 100 ? '(âœ… æ­£å¸¸)' : '(âš ï¸ åå¤§)'}<br>
                    ğŸ“ æ€»è®°å½•æ•°: ${records.length} æ¡ ${records.length <= 20 ? '(âœ… æ­£å¸¸)' : '(âš ï¸ è¶…å‡ºé™åˆ¶)'}<br>
                    ğŸ“… 2å‘¨å†…è®°å½•: ${recordsInTwoWeeks} æ¡<br>
                    ğŸ“¤ å¯¼å‡ºå†å²: ${state?.exportHistory?.length || 0} æ¡ ${(state?.exportHistory?.length || 0) <= 5 ? '(âœ… æ­£å¸¸)' : '(âš ï¸ è¶…å‡ºé™åˆ¶)'}<br>
                    ğŸ’¬ åé¦ˆæ•°é‡: ${state?.recommendationFeedback?.feedbacks?.length || 0} æ¡ ${(state?.recommendationFeedback?.feedbacks?.length || 0) <= 20 ? '(âœ… æ­£å¸¸)' : '(âš ï¸ è¶…å‡ºé™åˆ¶)'}<br>
                    ğŸ“‹ å¯¼å‡ºæ¨¡æ¿: ${state?.exportTemplates?.length || 0} ä¸ª ${(state?.exportTemplates?.length || 0) <= 5 ? '(âœ… æ­£å¸¸)' : '(âš ï¸ è¶…å‡ºé™åˆ¶)'}<br>
                    <br>
                    <strong>æœ€æ–°è®°å½•:</strong><br>
                    ${records.slice(0, 3).map(r => `- ${r.date}: ${r.symptoms?.join(', ') || 'æ— ç—‡çŠ¶'}`).join('<br>')}
                `;
                updateStats();
            } catch (e) {
                result.className = 'result error';
                result.innerHTML = `<strong>âŒ æ£€æŸ¥å¤±è´¥:</strong> ${e.message}`;
            }
        }

        // è§¦å‘å­˜å‚¨è­¦å‘Š
        function triggerStorageWarning(type) {
            const result = document.getElementById('warning-result');
            try {
                const messages = {
                    sessionStorage: 'å­˜å‚¨ç©ºé—´ä¸è¶³ï¼Œæ•°æ®å·²ä¸´æ—¶ä¿å­˜ã€‚å…³é—­æµè§ˆå™¨åæ•°æ®å°†ä¸¢å¤±ã€‚',
                    failed: 'å­˜å‚¨ç©ºé—´å·²æ»¡ï¼Œæ— æ³•ä¿å­˜æ•°æ®ã€‚è¯·æ¸…ç†æµè§ˆå™¨å­˜å‚¨æˆ–å¯¼å‡ºæ•°æ®ã€‚'
                };
                
                window.dispatchEvent(new CustomEvent('storage-warning', {
                    detail: {
                        type: type,
                        message: messages[type]
                    }
                }));
                
                result.className = 'result success';
                result.innerHTML = `
                    <strong>âœ… äº‹ä»¶è§¦å‘æˆåŠŸ</strong><br><br>
                    ç±»å‹: ${type}<br>
                    æ¶ˆæ¯: ${messages[type]}<br><br>
                    <strong>è¯·æ£€æŸ¥é¡µé¢å³ä¸Šè§’æ˜¯å¦æ˜¾ç¤º ${type === 'failed' ? 'çº¢è‰²' : 'é»„è‰²'} æç¤ºæ¡†</strong>
                `;
            } catch (e) {
                result.className = 'result error';
                result.innerHTML = `<strong>âŒ è§¦å‘å¤±è´¥:</strong> ${e.message}`;
            }
        }

        // æ¸…ç©ºæ‰€æœ‰æ•°æ®
        function clearAllData() {
            const result = document.getElementById('clear-result');
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                try {
                    localStorage.clear();
                    result.className = 'result success';
                    result.innerHTML = `
                        <strong>âœ… æ•°æ®å·²æ¸…ç©º</strong><br><br>
                        localStorage å·²å®Œå…¨æ¸…ç©º<br>
                        å»ºè®®åˆ·æ–°é¡µé¢ä»¥é‡ç½®çŠ¶æ€
                    `;
                    updateStats();
                } catch (e) {
                    result.className = 'result error';
                    result.innerHTML = `<strong>âŒ æ¸…ç©ºå¤±è´¥:</strong> ${e.message}`;
                }
            }
        }

        // ç”Ÿæˆæµ‹è¯•æ•°æ®
        function generateTestData(count) {
            const result = document.getElementById('generate-result');
            try {
                result.className = 'result info';
                result.innerHTML = `<strong>â³ æ­£åœ¨ç”Ÿæˆ ${count} æ¡æµ‹è¯•æ•°æ®...</strong>`;
                
                // è¿™ä¸ªå‡½æ•°éœ€è¦åœ¨å®é™…é¡µé¢ä¸­è¿è¡Œ
                result.className = 'result success';
                result.innerHTML = `
                    <strong>âœ… æµ‹è¯•æ•°æ®ç”ŸæˆæŒ‡å—</strong><br><br>
                    è¯·åœ¨ Workplace Wellness é¡µé¢ä¸­æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š<br><br>
                    1. æ‰“å¼€é¡µé¢: <a href="http://localhost:3001/zh/interactive-tools/workplace-wellness" target="_blank">ç‚¹å‡»è¿™é‡Œ</a><br>
                    2. æ‰‹åŠ¨æ·»åŠ  ${count} æ¡ç»æœŸè®°å½•<br>
                    3. é€‰æ‹©ä¸åŒçš„æ—¥æœŸï¼ˆåŒ…æ‹¬è¶…è¿‡2å‘¨çš„ï¼‰<br>
                    4. è§‚å¯Ÿæ˜¯å¦è§¦å‘è‡ªåŠ¨æ¸…ç†<br><br>
                    <strong>æˆ–è€…åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œè‡ªåŠ¨åŒ–è„šæœ¬ï¼ˆéœ€è¦åœ¨å®é™…é¡µé¢ä¸­ï¼‰</strong>
                `;
            } catch (e) {
                result.className = 'result error';
                result.innerHTML = `<strong>âŒ ç”Ÿæˆå¤±è´¥:</strong> ${e.message}`;
            }
        }

        // éªŒè¯æ•°æ®æ¸…ç†
        function verifyDataCleanup() {
            const result = document.getElementById('verify-result');
            try {
                const data = JSON.parse(localStorage.getItem('workplace-wellness-storage') || '{}');
                const state = data?.state || {};
                const records = state?.calendar?.periodData || [];
                
                const twoWeeksAgo = new Date();
                twoWeeksAgo.setDate(twoWeeksAgo.getDate() - 14);
                
                const tests = {
                    recordCount: {
                        test: records.length <= 20,
                        message: `è®°å½•æ•°é‡ ${records.length} ${records.length <= 20 ? 'âœ…' : 'âŒ'} (é¢„æœŸ <= 20)`
                    },
                    twoWeeksRule: {
                        test: records.every(r => {
                            try {
                                return new Date(r.date) >= twoWeeksAgo;
                            } catch {
                                return false;
                            }
                        }),
                        message: `2å‘¨è§„åˆ™ ${records.every(r => new Date(r.date) >= twoWeeksAgo) ? 'âœ…' : 'âŒ'} (æ‰€æœ‰è®°å½•åœ¨2å‘¨å†…)`
                    },
                    exportHistory: {
                        test: (state?.exportHistory?.length || 0) <= 5,
                        message: `å¯¼å‡ºå†å² ${state?.exportHistory?.length || 0} ${(state?.exportHistory?.length || 0) <= 5 ? 'âœ…' : 'âŒ'} (é¢„æœŸ <= 5)`
                    },
                    feedbacks: {
                        test: (state?.recommendationFeedback?.feedbacks?.length || 0) <= 20,
                        message: `åé¦ˆæ•°é‡ ${state?.recommendationFeedback?.feedbacks?.length || 0} ${(state?.recommendationFeedback?.feedbacks?.length || 0) <= 20 ? 'âœ…' : 'âŒ'} (é¢„æœŸ <= 20)`
                    },
                    templates: {
                        test: (state?.exportTemplates?.length || 0) <= 5,
                        message: `å¯¼å‡ºæ¨¡æ¿ ${state?.exportTemplates?.length || 0} ${(state?.exportTemplates?.length || 0) <= 5 ? 'âœ…' : 'âŒ'} (é¢„æœŸ <= 5)`
                    }
                };
                
                const allPass = Object.values(tests).every(t => t.test);
                
                result.className = allPass ? 'result success' : 'result error';
                result.innerHTML = `
                    <strong>${allPass ? 'âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡' : 'âŒ éƒ¨åˆ†æµ‹è¯•å¤±è´¥'}</strong><br><br>
                    ${Object.values(tests).map(t => t.message).join('<br>')}
                `;
                updateStats();
            } catch (e) {
                result.className = 'result error';
                result.innerHTML = `<strong>âŒ éªŒè¯å¤±è´¥:</strong> ${e.message}`;
            }
        }

        // è¿è¡Œå®Œæ•´æµ‹è¯•
        function runFullTest() {
            const result = document.getElementById('full-test-result');
            result.className = 'result info';
            result.innerHTML = '<strong>â³ æ­£åœ¨è¿è¡Œå®Œæ•´æµ‹è¯•...</strong>';
            
            setTimeout(() => {
                checkStorageStatus();
                setTimeout(() => {
                    verifyDataCleanup();
                    setTimeout(() => {
                        result.className = 'result success';
                        result.innerHTML = `
                            <strong>âœ… å®Œæ•´æµ‹è¯•å®Œæˆ</strong><br><br>
                            è¯·æŸ¥çœ‹ä¸Šæ–¹å„æµ‹è¯•çš„è¯¦ç»†ç»“æœ<br><br>
                            <strong>ä¸‹ä¸€æ­¥å»ºè®®:</strong><br>
                            1. æ£€æŸ¥é¡µé¢æ˜¯å¦æ­£å¸¸æ˜¾ç¤ºå­˜å‚¨è­¦å‘Š<br>
                            2. æµ‹è¯•"ç«‹å³å¯¼å‡º"åŠŸèƒ½<br>
                            3. æµ‹è¯•"æ¸…ç†æ—§æ•°æ®"åŠŸèƒ½<br>
                            4. éªŒè¯æ•°æ®æŒä¹…åŒ–ï¼ˆåˆ·æ–°é¡µé¢ï¼‰
                        `;
                    }, 500);
                }, 500);
            }, 500);
        }

        // é¡µé¢åŠ è½½æ—¶æ›´æ–°ç»Ÿè®¡
        updateStats();
        setInterval(updateStats, 2000); // æ¯2ç§’æ›´æ–°ä¸€æ¬¡
    </script>
</body>
</html>
