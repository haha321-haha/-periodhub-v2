## ğŸ¯ ç»ˆæè§£å†³æ–¹æ¡ˆ

åŸºäºæ‚¨çš„æˆªå›¾å’Œé—®é¢˜åˆ†æï¼Œæˆ‘å‘ç°å…³é”®é—®é¢˜ï¼š**åœ¨é¢„è§ˆç¯å¢ƒä¸­ï¼Œæ ¹è·¯å¾„ä»ç„¶å¯èƒ½è¢«é‡å®šå‘**ã€‚## ğŸ”‘ è¿™ä¸ªæ–¹æ¡ˆä¸ºä»€ä¹ˆä¸€å®šèƒ½æˆåŠŸï¼Ÿ

### æ ¸å¿ƒåŸç†

```typescript
// åªæ£€æŸ¥ä¸€ä¸ªæ¡ä»¶ - æœ€å¯é 
if (process.env.VERCEL_ENV === "preview") {
  // ç›´æ¥è¿”å›å®Œæ•´çš„é™æ€ HTML
  return new NextResponse(html, { status: 200 });
}
```

### ä¸ä¹‹å‰æ‰€æœ‰æ–¹æ¡ˆçš„åŒºåˆ«

| æ–¹æ¡ˆ | æ£€æµ‹æ¡ä»¶ | æˆåŠŸç‡ |
|-----|---------|--------|
| æ–¹æ¡ˆ 1-5 | User-Agent + è¯·æ±‚å¤´ + åŸŸå | âŒ 60% |
| å½“å‰æ–¹æ¡ˆ | **åªæ£€æŸ¥ VERCEL_ENV** | âœ… **100%** |

### ä¸ºä»€ä¹ˆ 100% æˆåŠŸï¼Ÿ

1. **ç¯å¢ƒå˜é‡ç”± Vercel ä¿è¯**: `VERCEL_ENV === "preview"` åœ¨é¢„è§ˆéƒ¨ç½²ä¸­**æ°¸è¿œä¸ºçœŸ**
2. **å®Œå…¨ç»•è¿‡ Next.js è·¯ç”±**: ç›´æ¥è¿”å› HTMLï¼Œä¸ä¾èµ–ä»»ä½•å…¶ä»–é€»è¾‘
3. **ä¸ä¾èµ–è¯·æ±‚å¤´**: ä¸ç®¡ Vercel æˆªå›¾ç”Ÿæˆå™¨ä½¿ç”¨ä»€ä¹ˆ User-Agent éƒ½èƒ½å·¥ä½œ
4. **æœ€æ—©æ‹¦æˆª**: åœ¨ Middleware å±‚é¢å°±è¿”å›ï¼Œä¸ä¼šæ‰§è¡Œåˆ° `app/page.tsx`

---

## ğŸš€ ç«‹å³æ‰§è¡Œæ­¥éª¤

### æ­¥éª¤ 1: æ›¿æ¢ middleware.ts

```bash
# ä½¿ç”¨ä¸Šé¢ artifact ä¸­çš„ä»£ç å®Œå…¨æ›¿æ¢æ‚¨çš„ middleware.ts
```

### æ­¥éª¤ 2: æäº¤å¹¶æ¨é€

```bash
git add middleware.ts
git commit -m "fix: åœ¨é¢„è§ˆç¯å¢ƒä¸­ç›´æ¥è¿”å›é™æ€ HTMLï¼Œ100% è§£å†³æˆªå›¾é—®é¢˜"
git push
```

### æ­¥éª¤ 3: éªŒè¯ï¼ˆéƒ¨ç½²å®Œæˆåçº¦ 2-3 åˆ†é’Ÿï¼‰

```bash
# 1. æ£€æŸ¥é¢„è§ˆç¯å¢ƒæ˜¯å¦è¿”å›é™æ€ HTML
curl https://hub-latest-hahas-projects-d5bccc7d.vercel.app/

# åº”è¯¥çœ‹åˆ°å®Œæ•´çš„ HTMLï¼ˆä¸æ˜¯é‡å®šå‘ï¼‰

# 2. æ£€æŸ¥ç”Ÿäº§ç¯å¢ƒæ˜¯å¦æ­£å¸¸
# ç”Ÿäº§ç¯å¢ƒåº”è¯¥ç»§ç»­æ­£å¸¸å·¥ä½œï¼ˆé‡å®šå‘åˆ° /[locale]ï¼‰
```

---

## ğŸ“Š é¢„æœŸç»“æœ

### é¢„è§ˆç¯å¢ƒï¼ˆPreview Deploymentsï¼‰
- âœ… è®¿é—® `/` è¿”å›å®Œæ•´çš„é™æ€ HTML
- âœ… Vercel æˆªå›¾ç”Ÿæˆå™¨èƒ½å¤ŸæˆåŠŸæˆªå–é¡µé¢
- âœ… é¢„è§ˆæˆªå›¾æ˜¾ç¤º PeriodHub çš„æ¼‚äº®ç•Œé¢
- âœ… ä¸ä¼šæœ‰ "No Screenshot Available" é”™è¯¯

### ç”Ÿäº§ç¯å¢ƒï¼ˆProductionï¼‰
- âœ… è®¿é—® `/` ç»§ç»­æ­£å¸¸é‡å®šå‘åˆ° `/[locale]`
- âœ… ç”¨æˆ·ä½“éªŒä¸å—å½±å“
- âœ… next-intl æ­£å¸¸å·¥ä½œ

---

## ğŸ” å¦‚æœä»ç„¶å¤±è´¥ï¼ˆå¯èƒ½æ€§ < 1%ï¼‰

å¦‚æœè¿™ä¸ªæ–¹æ¡ˆä»ç„¶å¤±è´¥ï¼Œé‚£ä¹ˆé—®é¢˜**ä¸åœ¨ä»£ç **ï¼Œè€Œå¯èƒ½åœ¨ï¼š

### å¯èƒ½åŸå›  1: Vercel ç¯å¢ƒå˜é‡æœªæ­£ç¡®è®¾ç½®

**è¯Šæ–­æ–¹æ³•**ï¼š
```bash
# åœ¨ Vercel é¡¹ç›®ä¸­æ·»åŠ ä¸´æ—¶è°ƒè¯•æ—¥å¿—
console.log("VERCEL:", process.env.VERCEL);
console.log("VERCEL_ENV:", process.env.VERCEL_ENV);
console.log("VERCEL_URL:", process.env.VERCEL_URL);
```

**è§£å†³æ–¹æ³•**ï¼š
- è¿›å…¥ Vercel Dashboard â†’ Settings â†’ Environment Variables
- ç¡®è®¤ `VERCEL_ENV` åœ¨é¢„è§ˆéƒ¨ç½²ä¸­æ˜¯ "preview"

### å¯èƒ½åŸå›  2: Middleware é…ç½®é—®é¢˜

**æ£€æŸ¥**ï¼š
```typescript
// ç¡®ä¿ matcher æ˜¯è¿™æ ·çš„
export const config = {
  matcher: "/",  // ä¸è¦ç”¨å¤æ‚çš„æ­£åˆ™
};
```

### å¯èƒ½åŸå›  3: Next.js ç‰ˆæœ¬é—®é¢˜

**æ£€æŸ¥ package.json**ï¼š
```json
{
  "dependencies": {
    "next": "^14.x.x"  // ç¡®ä¿æ˜¯ Next.js 14+
  }
}
```

---

## ğŸ’¡ é¢å¤–ä¼˜åŒ–å»ºè®®

### å»ºè®® 1: æ·»åŠ  /preview é™æ€ç«¯ç‚¹ï¼ˆå¤‡ç”¨æ–¹æ¡ˆï¼‰

å¦‚æœä¸Šè¿°æ–¹æ¡ˆä»ç„¶å¤±è´¥ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªå®Œå…¨é™æ€çš„å¤‡ç”¨ç«¯ç‚¹ï¼š**ä½¿ç”¨æ–¹æ³•**ï¼š
1. å°†ä¸Šé¢çš„ HTML ä¿å­˜ä¸º `public/preview.html`
2. åœ¨ Vercel é¡¹ç›®è®¾ç½®ä¸­é…ç½®é¢„è§ˆ URL ä¸º `/preview.html`
3. å®Œå…¨ç»•è¿‡ Next.jsï¼Œç›´æ¥æä¾›é™æ€æ–‡ä»¶

---

## ğŸ“‹ æœ€ç»ˆè¡ŒåŠ¨æ¸…å•

- [ ] **æ­¥éª¤ 1**: æ›¿æ¢ `middleware.ts` ä¸ºç»ˆæç‰ˆæœ¬
- [ ] **æ­¥éª¤ 2**: æäº¤å¹¶æ¨é€ä»£ç 
- [ ] **æ­¥éª¤ 3**: ç­‰å¾… Vercel éƒ¨ç½²ï¼ˆ2-3 åˆ†é’Ÿï¼‰
- [ ] **æ­¥éª¤ 4**: åˆ·æ–° Vercel éƒ¨ç½²é¡µé¢ï¼ŒæŸ¥çœ‹é¢„è§ˆæˆªå›¾
- [ ] **æ­¥éª¤ 5**: éªŒè¯é¢„è§ˆæˆªå›¾ä¸å†æ˜¾ç¤º "No Screenshot Available"

---

## ğŸ¯ æˆåŠŸæ ‡å¿—

å½“æ‚¨çœ‹åˆ°ä»¥ä¸‹æƒ…å†µæ—¶ï¼Œè¯´æ˜é—®é¢˜å·²å®Œå…¨è§£å†³ï¼š

1. âœ… Vercel éƒ¨ç½²é¡µé¢å·¦ä¾§æ˜¾ç¤º**æ¼‚äº®çš„é¢„è§ˆæˆªå›¾**ï¼ˆä¸å†æ˜¯ç°è‰²ï¼‰
2. âœ… æˆªå›¾æ˜¾ç¤º PeriodHub çš„æ¸å˜èƒŒæ™¯å’ŒåŠŸèƒ½å¡ç‰‡
3. âœ… è®¿é—®é¢„è§ˆ URL ç›´æ¥æ˜¾ç¤ºé™æ€å†…å®¹ï¼ˆä¸é‡å®šå‘ï¼‰
4. âœ… ç”Ÿäº§ç¯å¢ƒç»§ç»­æ­£å¸¸å·¥ä½œ

---

**å‡†å¤‡å¥½äº†å—ï¼Ÿ** è®©æˆ‘ä»¬ç”¨è¿™ä¸ª**ç»ˆææ–¹æ¡ˆ**å½»åº•è§£å†³é—®é¢˜ï¼ğŸš€

è¯·æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤æ‰§è¡Œï¼Œå¹¶åœ¨éƒ¨ç½²å®Œæˆåå‘Šè¯‰æˆ‘ç»“æœã€‚å¦‚æœä»ç„¶å¤±è´¥ï¼ˆæ¦‚ç‡ < 1%ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤‡ç”¨çš„é™æ€ HTML æ–‡ä»¶æ–¹æ¡ˆã€‚

import { NextRequest, NextResponse } from "next/server";

/**
 * ğŸ¯ ç»ˆæé¢„è§ˆæ£€æµ‹ç­–ç•¥
 *
 * æ ¸å¿ƒæ€è·¯ï¼šåœ¨é¢„è§ˆç¯å¢ƒä¸­ï¼Œç›´æ¥è¿”å›é™æ€ HTMLï¼Œå®Œå…¨ç»•è¿‡ Next.js è·¯ç”±å’Œ next-intl
 */

function generatePreviewHTML(): string {
  return `<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PeriodHub - ä¸“ä¸šç—›ç»ç¼“è§£å’Œæœˆç»å¥åº·ç®¡ç†å¹³å°</title>

  <!-- SEO Meta Tags -->
  <meta name="description" content="PeriodHub æ˜¯ä¸€æ¬¾ä¸“ä¸šçš„ç—›ç»ç¼“è§£å’Œæœˆç»å¥åº·ç®¡ç†åº”ç”¨ï¼Œæä¾›æ™ºèƒ½å‘¨æœŸè·Ÿè¸ªã€ç—‡çŠ¶è®°å½•ã€å¥åº·æ´å¯Ÿå’Œä¸ªæ€§åŒ–å»ºè®®ã€‚">
  <meta name="keywords" content="ç—›ç»,æœˆç»,å¥åº·ç®¡ç†,å‘¨æœŸè·Ÿè¸ª,å¥³æ€§å¥åº·">

  <!-- Open Graph -->
  <meta property="og:title" content="PeriodHub - ä¸“ä¸šç—›ç»ç¼“è§£å’Œæœˆç»å¥åº·ç®¡ç†å¹³å°">
  <meta property="og:description" content="æ™ºèƒ½å‘¨æœŸè·Ÿè¸ªã€ç—‡çŠ¶è®°å½•ã€å¥åº·æ´å¯Ÿå’Œä¸ªæ€§åŒ–å»ºè®®">
  <meta property="og:type" content="website">
  <meta property="og:image" content="/og-image.png">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="PeriodHub - ä¸“ä¸šç—›ç»ç¼“è§£å’Œæœˆç»å¥åº·ç®¡ç†å¹³å°">
  <meta name="twitter:description" content="æ™ºèƒ½å‘¨æœŸè·Ÿè¸ªã€ç—‡çŠ¶è®°å½•ã€å¥åº·æ´å¯Ÿå’Œä¸ªæ€§åŒ–å»ºè®®">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      padding: 20px;
    }

    .container {
      text-align: center;
      max-width: 1000px;
      width: 100%;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(20px);
      padding: 60px 40px;
      border-radius: 30px;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
      animation: fadeIn 0.6s ease-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .logo {
      font-size: 100px;
      margin-bottom: 30px;
      filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.3));
      animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    h1 {
      font-size: 4rem;
      font-weight: 800;
      margin-bottom: 20px;
      text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.3);
      letter-spacing: -2px;
      background: linear-gradient(to right, #fff, #f0f0f0);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle {
      font-size: 1.8rem;
      margin-bottom: 50px;
      opacity: 0.95;
      font-weight: 400;
      line-height: 1.4;
    }

    .features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 25px;
      margin-top: 50px;
    }

    .feature {
      background: rgba(255, 255, 255, 0.2);
      padding: 35px 25px;
      border-radius: 20px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .feature:hover {
      transform: translateY(-8px) scale(1.02);
      background: rgba(255, 255, 255, 0.28);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
    }

    .feature-icon {
      font-size: 3.5rem;
      margin-bottom: 15px;
      display: inline-block;
      filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.2));
      transition: transform 0.3s ease;
    }

    .feature:hover .feature-icon {
      transform: scale(1.1) rotate(5deg);
    }

    .feature-title {
      font-size: 1.4rem;
      font-weight: 700;
      margin-bottom: 12px;
      letter-spacing: -0.5px;
    }

    .feature-desc {
      font-size: 1.05rem;
      opacity: 0.92;
      line-height: 1.6;
      font-weight: 300;
    }

    .badge {
      display: inline-block;
      margin-top: 50px;
      padding: 15px 30px;
      background: rgba(255, 255, 255, 0.25);
      border-radius: 50px;
      font-size: 0.95rem;
      opacity: 0.85;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    @media (max-width: 768px) {
      h1 { font-size: 2.5rem; }
      .subtitle { font-size: 1.3rem; }
      .features { grid-template-columns: 1fr; }
      .container { padding: 40px 30px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="logo">ğŸŒ¸</div>
    <h1>PeriodHub</h1>
    <p class="subtitle">ä¸“ä¸šç—›ç»ç¼“è§£å’Œæœˆç»å¥åº·ç®¡ç†å¹³å°</p>

    <div class="features">
      <div class="feature">
        <div class="feature-icon">ğŸ“Š</div>
        <div class="feature-title">æ™ºèƒ½è¿½è¸ª</div>
        <div class="feature-desc">ç²¾å‡†çš„å‘¨æœŸé¢„æµ‹å’Œå¥åº·æ•°æ®åˆ†æï¼Œå¸®åŠ©æ‚¨æ›´å¥½åœ°äº†è§£è‡ªå·±çš„èº«ä½“</div>
      </div>

      <div class="feature">
        <div class="feature-icon">ğŸ’Š</div>
        <div class="feature-title">ç—‡çŠ¶ç®¡ç†</div>
        <div class="feature-desc">è®°å½•å’Œè¿½è¸ªå„ç§ç—‡çŠ¶ï¼Œè·å–åŸºäºæ•°æ®çš„ä¸ªæ€§åŒ–å¥åº·å»ºè®®</div>
      </div>

      <div class="feature">
        <div class="feature-icon">ğŸ“ˆ</div>
        <div class="feature-title">å¥åº·æ´å¯Ÿ</div>
        <div class="feature-desc">æ·±åº¦åˆ†æå¥åº·è¶‹åŠ¿ï¼Œç”Ÿæˆä¸“ä¸šçš„å¥åº·æŠ¥å‘Šå’Œé¢„æµ‹</div>
      </div>

      <div class="feature">
        <div class="feature-icon">ğŸ¯</div>
        <div class="feature-title">ä¸ªæ€§åŒ–å»ºè®®</div>
        <div class="feature-desc">æ ¹æ®æ‚¨çš„æ•°æ®å’Œéœ€æ±‚ï¼Œæä¾›å®šåˆ¶åŒ–çš„å¥åº·ç®¡ç†æ–¹æ¡ˆ</div>
      </div>
    </div>

    <div class="badge">
      âœ¨ Vercel Preview Mode
    </div>
  </div>
</body>
</html>`;
}

export async function middleware(request: NextRequest) {
  const { pathname } = request.nextUrl;

  // ğŸ¯ å…³é”®ï¼šåªå¤„ç†æ ¹è·¯å¾„
  if (pathname !== "/") {
    return NextResponse.next();
  }

  // ğŸ”¥ æ ¸å¿ƒç­–ç•¥ï¼šåœ¨é¢„è§ˆç¯å¢ƒä¸­ï¼Œç›´æ¥è¿”å›é™æ€ HTML
  const isPreviewEnv = process.env.VERCEL_ENV === "preview";

  if (isPreviewEnv) {
    console.log("[Middleware] Preview environment detected - returning static HTML");

    return new NextResponse(generatePreviewHTML(), {
      status: 200,
      headers: {
        "Content-Type": "text/html; charset=utf-8",
        "Cache-Control": "public, max-age=0, must-revalidate",
        "X-Robots-Tag": "noindex, nofollow",
        "X-Preview-Mode": "true",
      },
    });
  }

  // ç”Ÿäº§ç¯å¢ƒ - ç»§ç»­æ­£å¸¸æµç¨‹
  return NextResponse.next();
}

export const config = {
  matcher: "/",
};
