# P2 阶段代码质量修复执行计划

## 当前状态

**生成时间：** 2025-11-22  
**ESLint 问题总数：** 1637 个

### 问题分类

| 问题类型 | 数量 | 优先级 | 预计时间 |
|---------|------|--------|---------|
| @typescript-eslint/no-explicit-any | 546 | 🔴 高 | 8-10h |
| @typescript-eslint/no-unused-vars | 414 | 🟡 中 | 3-4h |
| react-hooks/exhaustive-deps | 52 | 🟠 中高 | 2-3h |
| react-hooks/rules-of-hooks | 8 | 🔴 高 | 1h |

**总预计时间：** 14-18 小时

---

## 执行策略

### 阶段 1：Hook 问题修复（优先）
**预计时间：** 3-4 小时

#### 1.1 修复 rules-of-hooks（8 个）
- 这些是严重的 Hook 使用错误
- 必须手动修复
- 可能影响功能

#### 1.2 修复 exhaustive-deps（52 个）
- Hook 依赖缺失
- 部分可以自动修复
- 需要仔细检查避免无限循环

**验证命令：**
```bash
npx eslint "app/**/*.{ts,tsx}" --format=compact | grep "react-hooks"
```

---

### 阶段 2：未使用变量清理
**预计时间：** 3-4 小时

#### 2.1 自动修复简单情况
```bash
npx eslint "app/**/*.{ts,tsx}" --fix --rule '@typescript-eslint/no-unused-vars: error'
```

#### 2.2 手动检查复杂情况
- 未使用的导入
- 未使用的函数参数
- 未使用的变量声明

**注意事项：**
- 某些"未使用"的变量可能是有意保留的
- 需要检查是否影响类型推断
- 注意解构赋值中的占位符

---

### 阶段 3：Any 类型替换
**预计时间：** 8-10 小时

#### 3.1 按模块优先级修复

**P0 - 核心业务逻辑（546 个中的 ~100 个）：**
- interactive-tools/
- scenario-solutions/
- lib/

**P1 - 工具和辅助（~200 个）：**
- components/
- hooks/
- utils/

**P2 - 其他（~246 个）：**
- 测试文件
- 配置文件
- 示例代码

#### 3.2 替换策略
1. **数据类型** → 使用具体接口
2. **未知值** → 使用 `unknown`
3. **对象** → 使用 `Record<string, unknown>`
4. **函数参数** → 定义类型
5. **泛型** → 使用适当的泛型约束

---

## 分批执行计划

### 第 1 批：Hook 问题（Day 1）
- [ ] 修复 8 个 rules-of-hooks 错误
- [ ] 修复 52 个 exhaustive-deps 警告
- [ ] 运行测试验证
- [ ] 提交代码

### 第 2 批：未使用变量（Day 2）
- [ ] 运行 eslint --fix 自动修复
- [ ] 手动检查剩余问题
- [ ] 验证功能正常
- [ ] 提交代码

### 第 3 批：Any 类型 - P0（Day 3-4）
- [ ] interactive-tools/ 模块
- [ ] scenario-solutions/ 模块
- [ ] lib/ 核心库
- [ ] 提交代码

### 第 4 批：Any 类型 - P1（Day 5-6）
- [ ] components/ 组件
- [ ] hooks/ 钩子
- [ ] utils/ 工具
- [ ] 提交代码

### 第 5 批：Any 类型 - P2（Day 7）
- [ ] 剩余文件
- [ ] 最终验证
- [ ] 提交代码

---

## 风险评估

### 高风险操作
1. **Hook 依赖修复** - 可能导致无限循环或性能问题
2. **删除未使用变量** - 可能影响类型推断
3. **Any 类型替换** - 可能暴露隐藏的类型错误

### 缓解措施
1. **分批提交** - 每批修复后立即提交
2. **充分测试** - 每批修复后运行测试
3. **代码审查** - 重要模块需要仔细审查
4. **回滚准备** - 保持 git 历史清晰，便于回滚

---

## 验证清单

每批修复后必须验证：

- [ ] TypeScript 编译通过
  ```bash
  npx tsc --noEmit
  ```

- [ ] ESLint 检查通过
  ```bash
  npx eslint <files> --format=compact
  ```

- [ ] 构建成功
  ```bash
  npm run build
  ```

- [ ] 关键功能测试
  - 页面加载正常
  - 交互功能正常
  - 无控制台错误

---

## 当前进度

### ✅ 已完成（P0 + P1）
- Pain Tracker ESLint 修复
- PartnerCommunication 类型修复
- Health Guide 类型修复
- SymptomAssessmentTool Hook 依赖修复

### 🔄 进行中（P2）
- 准备开始 Hook 问题批量修复

### ⏳ 待完成
- 未使用变量清理
- Any 类型大规模替换

---

## 建议

鉴于 P2 阶段的工作量很大（14-18 小时），建议：

1. **分阶段进行** - 不要一次性完成所有修复
2. **优先修复 Hook 问题** - 这些可能影响功能
3. **Any 类型可以持续优化** - 不是紧急问题
4. **保持代码可用性** - 不要为了修复而破坏功能

---

## 下一步行动

**立即执行：**
1. 修复 8 个 rules-of-hooks 错误（1 小时）
2. 修复 52 个 exhaustive-deps 警告（2-3 小时）

**后续计划：**
3. 清理未使用变量（3-4 小时）
4. 逐步替换 any 类型（持续进行）

---

**报告生成时间：** 2025-11-22  
**预计完成时间：** 1-2 周（分批进行）
