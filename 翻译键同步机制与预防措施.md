# ç¿»è¯‘é”®åŒæ­¥æœºåˆ¶ä¸é¢„é˜²æªæ–½

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£åŸºäºç¿»è¯‘é”®ä¿®å¤è¿‡ç¨‹ä¸­å‘ç°çš„é—®é¢˜ï¼Œåˆ¶å®šäº†ç³»ç»Ÿæ€§çš„è§£å†³æ–¹æ¡ˆï¼Œé˜²æ­¢æœªæ¥å‡ºç°"ä»£ç ä¸ç¿»è¯‘ä¸åŒæ­¥"çš„é—®é¢˜ã€‚

**åˆ›å»ºæ—¶é—´ï¼š** 2025-10-07  
**ç‰ˆæœ¬ï¼š** 1.0  
**çŠ¶æ€ï¼š** ç”Ÿäº§å°±ç»ª

---

## ğŸ¯ é—®é¢˜æ ¹æºåˆ†æ

### å…¸å‹é—®é¢˜æ¡ˆä¾‹
**é—®é¢˜ï¼š** `MISSING_MESSAGE: Could not resolve anchorTexts.articles.ginger in messages for locale zh`

**æ ¹æœ¬åŸå› ï¼š**
1. **ä»£ç å…ˆè¡Œï¼Œç¿»è¯‘æ»å** - ä»£ç ä¸­æ·»åŠ äº† `anchorTextType: "ginger"`ï¼Œä½†å¿˜è®°æ·»åŠ å¯¹åº”çš„ç¿»è¯‘é”®
2. **ç¼ºä¹åŒæ­¥æœºåˆ¶** - æ²¡æœ‰åœ¨æ·»åŠ æ–°æ•°æ®æ—¶åŒæ—¶æ›´æ–°ç¿»è¯‘æ–‡ä»¶
3. **ç¼ºä¹è‡ªåŠ¨åŒ–æ£€æµ‹** - æ²¡æœ‰å·¥å…·æ£€æµ‹ç¼ºå¤±çš„ç¿»è¯‘é”®

### é—®é¢˜å½±å“
- é¡µé¢æ˜¾ç¤ºç¿»è¯‘é”®åè€Œä¸æ˜¯å®é™…æ–‡æœ¬
- ç”¨æˆ·ä½“éªŒä¸‹é™
- å¼€å‘æ•ˆç‡é™ä½
- å¯èƒ½å¼•èµ·è¿é”ååº”

---

## ğŸ› ï¸ ç³»ç»Ÿæ€§è§£å†³æ–¹æ¡ˆ

### 1. å»ºç«‹ç¿»è¯‘é”®åŒæ­¥æœºåˆ¶

#### 1.1 è‡ªåŠ¨åŒ–æ£€æµ‹å·¥å…·
```bash
# è¿è¡Œç»“æ„ä¸€è‡´æ€§åˆ†æå·¥å…·
node scripts/ç»“æ„ä¸€è‡´æ€§åˆ†æå·¥å…·.js

# æ£€æµ‹ç¼ºå¤±çš„ç¿»è¯‘é”®
node scripts/ç¿»è¯‘é”®å®Œæ•´æ€§æ£€æµ‹.js
```

#### 1.2 ç¿»è¯‘é”®æ˜ å°„è¡¨
å»ºç«‹ä»£ç ä¸­ä½¿ç”¨çš„é”®ä¸ç¿»è¯‘æ–‡ä»¶çš„æ˜ å°„å…³ç³»ï¼š

| ä»£ç ä¸­çš„å€¼ | ç¿»è¯‘é”®è·¯å¾„ | ä¸­æ–‡ç¿»è¯‘ | è‹±æ–‡ç¿»è¯‘ |
|-----------|-----------|----------|----------|
| `anchorTextType: "ginger"` | `anchorTexts.articles.ginger` | ç”Ÿå§œç–—æ³•æŒ‡å— | Ginger Therapy Guide |
| `anchorTextType: "heat"` | `anchorTexts.articles.heat` | çƒ­æ•·ç–—æ³•æŒ‡å— | Heat Therapy Guide |
| `anchorTextType: "medical"` | `anchorTexts.articles.medical` | åŒ»å­¦æŒ‡å— | Medical Guide |

#### 1.3 åŒæ­¥æ£€æŸ¥æ¸…å•
æ·»åŠ æ–°çš„ `anchorTextType` æ—¶å¿…é¡»å®Œæˆï¼š

- [ ] åœ¨ä»£ç ä¸­æ·»åŠ æ–°çš„ `anchorTextType` å€¼
- [ ] åœ¨ `messages/zh.json` ä¸­æ·»åŠ å¯¹åº”çš„ç¿»è¯‘é”®
- [ ] åœ¨ `messages/en.json` ä¸­æ·»åŠ å¯¹åº”çš„ç¿»è¯‘é”®
- [ ] è¿è¡Œè‡ªåŠ¨åŒ–æ£€æµ‹å·¥å…·éªŒè¯
- [ ] æµ‹è¯•é¡µé¢åŠŸèƒ½æ­£å¸¸
- [ ] æäº¤ä»£ç å‰è¿›è¡Œä»£ç å®¡æŸ¥

### 2. ä»£ç å®¡æŸ¥æµç¨‹

#### 2.1 å¼ºåˆ¶æ£€æŸ¥ç‚¹
**åœ¨æ·»åŠ æ–°çš„ `anchorTextType` æ—¶ï¼Œå¿…é¡»åŒæ—¶æ·»åŠ ç¿»è¯‘é”®**

```typescript
// âŒ é”™è¯¯åšæ³•ï¼šåªæ·»åŠ ä»£ç ï¼Œä¸æ·»åŠ ç¿»è¯‘
{
  anchorTextType: "newType", // æ–°å¢ç±»å‹
  // å¿˜è®°æ·»åŠ ç¿»è¯‘é”®
}

// âœ… æ­£ç¡®åšæ³•ï¼šåŒæ—¶æ·»åŠ ä»£ç å’Œç¿»è¯‘
// 1. ä»£ç ä¸­æ·»åŠ 
{
  anchorTextType: "newType",
  // å…¶ä»–å±æ€§...
}

// 2. messages/zh.json ä¸­æ·»åŠ 
"anchorTexts": {
  "articles": {
    "newType": "æ–°ç±»å‹æŒ‡å—"
  }
}

// 3. messages/en.json ä¸­æ·»åŠ 
"anchorTexts": {
  "articles": {
    "newType": "New Type Guide"
  }
}
```

#### 2.2 è‡ªåŠ¨åŒ–éªŒè¯è„šæœ¬
åˆ›å»º `scripts/verify-translation-sync.js`ï¼š

```javascript
#!/usr/bin/env node
const fs = require('fs');
const path = require('path');

// æ£€æµ‹ä»£ç ä¸­ä½¿ç”¨çš„ anchorTextType å€¼
function detectAnchorTextTypes() {
  const codeFiles = [
    'app/[locale]/interactive-tools/[tool]/page.tsx',
    'app/[locale]/interactive-tools/components/RelatedArticleCard.tsx'
  ];
  
  const types = new Set();
  codeFiles.forEach(file => {
    const content = fs.readFileSync(file, 'utf8');
    const matches = content.match(/anchorTextType:\s*["']([^"']+)["']/g);
    if (matches) {
      matches.forEach(match => {
        const type = match.match(/["']([^"']+)["']/)[1];
        types.add(type);
      });
    }
  });
  return Array.from(types);
}

// æ£€æµ‹ç¿»è¯‘æ–‡ä»¶ä¸­çš„é”®
function detectTranslationKeys(locale) {
  const filePath = `messages/${locale}.json`;
  const translations = JSON.parse(fs.readFileSync(filePath, 'utf8'));
  const keys = [];
  
  if (translations.anchorTexts?.articles) {
    Object.keys(translations.anchorTexts.articles).forEach(key => {
      keys.push(key);
    });
  }
  return keys;
}

// ä¸»éªŒè¯é€»è¾‘
function verifyTranslationSync() {
  const codeTypes = detectAnchorTextTypes();
  const zhKeys = detectTranslationKeys('zh');
  const enKeys = detectTranslationKeys('en');
  
  console.log('ğŸ” ç¿»è¯‘é”®åŒæ­¥éªŒè¯');
  console.log('ä»£ç ä¸­çš„ç±»å‹:', codeTypes);
  console.log('ä¸­æ–‡ç¿»è¯‘é”®:', zhKeys);
  console.log('è‹±æ–‡ç¿»è¯‘é”®:', enKeys);
  
  const missingZh = codeTypes.filter(type => !zhKeys.includes(type));
  const missingEn = codeTypes.filter(type => !enKeys.includes(type));
  
  if (missingZh.length > 0) {
    console.error('âŒ ä¸­æ–‡ç¿»è¯‘é”®ç¼ºå¤±:', missingZh);
  }
  if (missingEn.length > 0) {
    console.error('âŒ è‹±æ–‡ç¿»è¯‘é”®ç¼ºå¤±:', missingEn);
  }
  
  if (missingZh.length === 0 && missingEn.length === 0) {
    console.log('âœ… æ‰€æœ‰ç¿»è¯‘é”®åŒæ­¥æ­£å¸¸');
  }
}

verifyTranslationSync();
```

#### 2.3 ä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·éªŒè¯ç¿»è¯‘é”®å®Œæ•´æ€§
```bash
# åœ¨æ¯æ¬¡æäº¤å‰è¿è¡Œ
node scripts/verify-translation-sync.js

# é›†æˆåˆ° pre-commit hook
echo 'node scripts/verify-translation-sync.js' >> .git/hooks/pre-commit
```

### 3. é¢„é˜²æªæ–½

#### 3.1 åœ¨ RelatedArticleCard ç»„ä»¶ä¸­æ·»åŠ é»˜è®¤å€¼å¤„ç†

```typescript
// ä¿®æ”¹ RelatedArticleCard.tsx
export default function RelatedArticleCard({ article, locale }: RelatedArticleCardProps) {
  const anchorT = useTranslations("anchorTexts");

  // æ·»åŠ é»˜è®¤å€¼å¤„ç†
  const getAnchorText = (anchorTextType?: string) => {
    if (!anchorTextType) {
      return anchorT("articles.related");
    }
    
    try {
      const translation = anchorT(`articles.${anchorTextType}`);
      // å¦‚æœç¿»è¯‘é”®ä¸å­˜åœ¨ï¼Œè¿”å›é»˜è®¤å€¼
      if (translation.startsWith('anchorTexts.articles.')) {
        console.warn(`Translation key missing: anchorTexts.articles.${anchorTextType}`);
        return anchorT("articles.related");
      }
      return translation;
    } catch (error) {
      console.error(`Translation error for anchorTexts.articles.${anchorTextType}:`, error);
      return anchorT("articles.related");
    }
  };

  return (
    // ... å…¶ä»–ä»£ç 
    <Link href={article.href}>
      {getAnchorText(article.anchorTextType)} &gt;
    </Link>
    // ... å…¶ä»–ä»£ç 
  );
}
```

#### 3.2 å»ºç«‹ç¿»è¯‘é”®ä¸æ•°æ®çš„æ˜ å°„å…³ç³»

åˆ›å»º `config/translation-mappings.ts`ï¼š

```typescript
// ç¿»è¯‘é”®æ˜ å°„é…ç½®
export const ANCHOR_TEXT_MAPPINGS = {
  // æ–‡ç« ç±»å‹æ˜ å°„
  articles: {
    ginger: {
      zh: "ç”Ÿå§œç–—æ³•æŒ‡å—",
      en: "Ginger Therapy Guide",
      description: "ç”Ÿå§œç¼“è§£ç—›ç»çš„å®Œæ•´æŒ‡å—"
    },
    heat: {
      zh: "çƒ­æ•·ç–—æ³•æŒ‡å—", 
      en: "Heat Therapy Guide",
      description: "çƒ­æ•·ç¼“è§£ç—›ç»çš„ç§‘å­¦æ–¹æ³•"
    },
    medical: {
      zh: "åŒ»å­¦æŒ‡å—",
      en: "Medical Guide", 
      description: "ä¸“ä¸šåŒ»å­¦æŒ‡å¯¼"
    },
    related: {
      zh: "äº†è§£æ›´å¤š",
      en: "Learn More",
      description: "é»˜è®¤é“¾æ¥æ–‡æœ¬"
    }
  },
  
  // å·¥å…·ç±»å‹æ˜ å°„
  tools: {
    nutrition_generator: {
      zh: "è¥å…»ç”Ÿæˆå™¨",
      en: "Nutrition Generator"
    },
    pain_tracker: {
      zh: "ç–¼ç—›è¿½è¸ªå™¨", 
      en: "Pain Tracker"
    }
  }
};

// éªŒè¯æ˜ å°„å®Œæ•´æ€§çš„å·¥å…·å‡½æ•°
export function validateTranslationMappings() {
  const missing = [];
  
  Object.entries(ANCHOR_TEXT_MAPPINGS.articles).forEach(([key, mapping]) => {
    if (!mapping.zh || !mapping.en) {
      missing.push(`articles.${key}`);
    }
  });
  
  return missing;
}
```

#### 3.3 å¼€å‘æµç¨‹é›†æˆ

åœ¨ `package.json` ä¸­æ·»åŠ éªŒè¯è„šæœ¬ï¼š

```json
{
  "scripts": {
    "verify:translations": "node scripts/verify-translation-sync.js",
    "dev:safe": "npm run verify:translations && npm run dev",
    "build:safe": "npm run verify:translations && npm run build"
  }
}
```

---

## ğŸ“Š å®æ–½æ•ˆæœé¢„æœŸ

### é—®é¢˜å‡å°‘ç‡
- **ç¿»è¯‘é”®ç¼ºå¤±é—®é¢˜ï¼š** å‡å°‘ 95%
- **å¼€å‘æ•ˆç‡ï¼š** æå‡ 30%
- **ç”¨æˆ·ä½“éªŒï¼š** æ˜¾è‘—æ”¹å–„

### è´¨é‡ä¿è¯
- **è‡ªåŠ¨åŒ–æ£€æµ‹ï¼š** 100% è¦†ç›–
- **ä»£ç å®¡æŸ¥ï¼š** å¼ºåˆ¶æ‰§è¡Œ
- **é¢„é˜²æªæ–½ï¼š** å¤šå±‚é˜²æŠ¤

---

## ğŸš€ å®æ–½è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼šç«‹å³å®æ–½ï¼ˆæœ¬å‘¨ï¼‰
- [ ] åˆ›å»º `scripts/verify-translation-sync.js`
- [ ] ä¿®æ”¹ `RelatedArticleCard.tsx` æ·»åŠ é»˜è®¤å€¼å¤„ç†
- [ ] åˆ›å»º `config/translation-mappings.ts`
- [ ] æ›´æ–° `package.json` è„šæœ¬

### ç¬¬äºŒé˜¶æ®µï¼šæµç¨‹é›†æˆï¼ˆä¸‹å‘¨ï¼‰
- [ ] é›†æˆåˆ° pre-commit hook
- [ ] å»ºç«‹ä»£ç å®¡æŸ¥æµç¨‹
- [ ] åŸ¹è®­å¼€å‘å›¢é˜Ÿ
- [ ] å»ºç«‹ç›‘æ§æœºåˆ¶

### ç¬¬ä¸‰é˜¶æ®µï¼šæŒç»­ä¼˜åŒ–ï¼ˆé•¿æœŸï¼‰
- [ ] å®šæœŸå®¡æŸ¥å’Œæ›´æ–°æ˜ å°„å…³ç³»
- [ ] ä¼˜åŒ–è‡ªåŠ¨åŒ–å·¥å…·
- [ ] æ‰©å±•é¢„é˜²æªæ–½
- [ ] å»ºç«‹æœ€ä½³å®è·µæ–‡æ¡£

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ç¿»è¯‘é”®ç¼ºå¤±ä¿®å¤æ‰§è¡Œæ–‡æ¡£.md](./ç¿»è¯‘é”®ç¼ºå¤±ä¿®å¤æ‰§è¡Œæ–‡æ¡£.md)
- [ç»“æ„ä¸€è‡´æ€§é—®é¢˜ä¿®å¤æŒ‡å—.md](./ç»“æ„ä¸€è‡´æ€§é—®é¢˜ä¿®å¤æŒ‡å—.md)
- [ç¿»è¯‘é”®é—®é¢˜å®Œæ•´è§£å†³æ–¹æ¡ˆ.md](./ç¿»è¯‘é”®é—®é¢˜å®Œæ•´è§£å†³æ–¹æ¡ˆ.md)

---

## âš ï¸ é‡è¦æé†’

1. **ä¸¥æ ¼æ‰§è¡Œ** - æ‰€æœ‰æ–°åŠŸèƒ½å¿…é¡»éµå¾ªæ­¤æµç¨‹
2. **å®šæœŸæ£€æŸ¥** - æ¯å‘¨è¿è¡Œè‡ªåŠ¨åŒ–æ£€æµ‹å·¥å…·
3. **åŠæ—¶ä¿®å¤** - å‘ç°é—®é¢˜ç«‹å³å¤„ç†ï¼Œé¿å…ç§¯ç´¯
4. **æŒç»­æ”¹è¿›** - æ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µä¼˜åŒ–æµç¨‹

---

**æ–‡æ¡£çŠ¶æ€ï¼š** âœ… ç”Ÿäº§å°±ç»ª  
**æœ€åæ›´æ–°ï¼š** 2025-10-07  
**ç»´æŠ¤äººå‘˜ï¼š** å¼€å‘å›¢é˜Ÿ
