#!/bin/bash

# éƒ¨ç½²æµ‹è¯•è„šæœ¬
# ç”¨äºŽéªŒè¯ç—›ç»å½±å“è¯„ä¼°å·¥å…·åœ¨æµ‹è¯•çŽ¯å¢ƒçš„éƒ¨ç½²

echo "ðŸš€ å¼€å§‹éƒ¨ç½²æµ‹è¯•..."

# 1. æ£€æŸ¥éƒ¨ç½²çŽ¯å¢ƒ
echo "=== 1. éƒ¨ç½²çŽ¯å¢ƒæ£€æŸ¥ ==="
echo "Node.jsç‰ˆæœ¬:"
node --version
echo "npmç‰ˆæœ¬:"
npm --version
echo "Gitç‰ˆæœ¬:"
git --version
echo ""

# 2. å®‰è£…ä¾èµ–
echo "=== 2. å®‰è£…ä¾èµ– ==="
npm install
if [ $? -eq 0 ]; then
    echo "âœ… ä¾èµ–å®‰è£…æˆåŠŸ"
else
    echo "âŒ ä¾èµ–å®‰è£…å¤±è´¥"
    exit 1
fi
echo ""

# 3. æž„å»ºé¡¹ç›®
echo "=== 3. æž„å»ºé¡¹ç›® ==="
npm run build
if [ $? -eq 0 ]; then
    echo "âœ… é¡¹ç›®æž„å»ºæˆåŠŸ"
else
    echo "âŒ é¡¹ç›®æž„å»ºå¤±è´¥"
    exit 1
fi
echo ""

# 4. å¯åŠ¨å¼€å‘æœåŠ¡å™¨è¿›è¡Œæµ‹è¯•
echo "=== 4. å¯åŠ¨æµ‹è¯•æœåŠ¡å™¨ ==="
echo "å¯åŠ¨å¼€å‘æœåŠ¡å™¨è¿›è¡ŒåŠŸèƒ½æµ‹è¯•..."
echo "æœåŠ¡å™¨å°†åœ¨ http://localhost:3001 å¯åŠ¨"
echo ""

# å¯åŠ¨æœåŠ¡å™¨ï¼ˆåŽå°è¿è¡Œï¼‰
npm run dev &
SERVER_PID=$!

# ç­‰å¾…æœåŠ¡å™¨å¯åŠ¨
echo "ç­‰å¾…æœåŠ¡å™¨å¯åŠ¨..."
sleep 10

# 5. åŠŸèƒ½æµ‹è¯•
echo "=== 5. åŠŸèƒ½æµ‹è¯• ==="

# æµ‹è¯•ç—‡çŠ¶è¯„ä¼°é¡µé¢
echo "æµ‹è¯•ç—‡çŠ¶è¯„ä¼°é¡µé¢..."
curl -s -o /dev/null -w "HTTPçŠ¶æ€ç : %{http_code}\nå“åº”æ—¶é—´: %{time_total}s\n" "http://localhost:3001/zh/interactive-tools/symptom-assessment"
if [ $? -eq 0 ]; then
    echo "âœ… ä¸­æ–‡ç—‡çŠ¶è¯„ä¼°é¡µé¢æµ‹è¯•é€šè¿‡"
else
    echo "âŒ ä¸­æ–‡ç—‡çŠ¶è¯„ä¼°é¡µé¢æµ‹è¯•å¤±è´¥"
fi

curl -s -o /dev/null -w "HTTPçŠ¶æ€ç : %{http_code}\nå“åº”æ—¶é—´: %{time_total}s\n" "http://localhost:3001/en/interactive-tools/symptom-assessment"
if [ $? -eq 0 ]; then
    echo "âœ… è‹±æ–‡ç—‡çŠ¶è¯„ä¼°é¡µé¢æµ‹è¯•é€šè¿‡"
else
    echo "âŒ è‹±æ–‡ç—‡çŠ¶è¯„ä¼°é¡µé¢æµ‹è¯•å¤±è´¥"
fi

# æµ‹è¯•äº¤äº’å·¥å…·é¡µé¢
echo "æµ‹è¯•äº¤äº’å·¥å…·é¡µé¢..."
curl -s -o /dev/null -w "HTTPçŠ¶æ€ç : %{http_code}\nå“åº”æ—¶é—´: %{time_total}s\n" "http://localhost:3001/zh/interactive-tools"
if [ $? -eq 0 ]; then
    echo "âœ… ä¸­æ–‡äº¤äº’å·¥å…·é¡µé¢æµ‹è¯•é€šè¿‡"
else
    echo "âŒ ä¸­æ–‡äº¤äº’å·¥å…·é¡µé¢æµ‹è¯•å¤±è´¥"
fi

curl -s -o /dev/null -w "HTTPçŠ¶æ€ç : %{http_code}\nå“åº”æ—¶é—´: %{time_total}s\n" "http://localhost:3001/en/interactive-tools"
if [ $? -eq 0 ]; then
    echo "âœ… è‹±æ–‡äº¤äº’å·¥å…·é¡µé¢æµ‹è¯•é€šè¿‡"
else
    echo "âŒ è‹±æ–‡äº¤äº’å·¥å…·é¡µé¢æµ‹è¯•å¤±è´¥"
fi

# æµ‹è¯•ä¸»é¡µ
echo "æµ‹è¯•ä¸»é¡µ..."
curl -s -o /dev/null -w "HTTPçŠ¶æ€ç : %{http_code}\nå“åº”æ—¶é—´: %{time_total}s\n" "http://localhost:3001/zh"
if [ $? -eq 0 ]; then
    echo "âœ… ä¸­æ–‡ä¸»é¡µæµ‹è¯•é€šè¿‡"
else
    echo "âŒ ä¸­æ–‡ä¸»é¡µæµ‹è¯•å¤±è´¥"
fi

curl -s -o /dev/null -w "HTTPçŠ¶æ€ç : %{http_code}\nå“åº”æ—¶é—´: %{time_total}s\n" "http://localhost:3001/en"
if [ $? -eq 0 ]; then
    echo "âœ… è‹±æ–‡ä¸»é¡µæµ‹è¯•é€šè¿‡"
else
    echo "âŒ è‹±æ–‡ä¸»é¡µæµ‹è¯•å¤±è´¥"
fi

echo ""

# 6. æ€§èƒ½æµ‹è¯•
echo "=== 6. æ€§èƒ½æµ‹è¯• ==="
echo "æµ‹è¯•é¡µé¢åŠ è½½æ€§èƒ½..."

# æµ‹è¯•ç—‡çŠ¶è¯„ä¼°é¡µé¢æ€§èƒ½
echo "ç—‡çŠ¶è¯„ä¼°é¡µé¢æ€§èƒ½æµ‹è¯•:"
curl -s -o /dev/null -w "æ€»æ—¶é—´: %{time_total}s\nè¿žæŽ¥æ—¶é—´: %{time_connect}s\né¦–å­—èŠ‚æ—¶é—´: %{time_starttransfer}s\n" "http://localhost:3001/zh/interactive-tools/symptom-assessment"

echo ""

# 7. åœæ­¢æµ‹è¯•æœåŠ¡å™¨
echo "=== 7. åœæ­¢æµ‹è¯•æœåŠ¡å™¨ ==="
kill $SERVER_PID
echo "æµ‹è¯•æœåŠ¡å™¨å·²åœæ­¢"
echo ""

# 8. ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
echo "=== 8. ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š ==="
cat > DEPLOYMENT_TEST_REPORT.md << 'EOF'
# éƒ¨ç½²æµ‹è¯•æŠ¥å‘Š

## ðŸŽ¯ æµ‹è¯•æ¦‚è¿°
**æµ‹è¯•æ—¶é—´**: $(date)
**æµ‹è¯•çŽ¯å¢ƒ**: æœ¬åœ°å¼€å‘çŽ¯å¢ƒ
**æµ‹è¯•èŒƒå›´**: ç—›ç»å½±å“è¯„ä¼°å·¥å…·å®Œæ•´åŠŸèƒ½

## âœ… æµ‹è¯•ç»“æžœ

### çŽ¯å¢ƒæ£€æŸ¥
- âœ… Node.jsçŽ¯å¢ƒæ­£å¸¸
- âœ… npmçŽ¯å¢ƒæ­£å¸¸
- âœ… GitçŽ¯å¢ƒæ­£å¸¸

### æž„å»ºæµ‹è¯•
- âœ… ä¾èµ–å®‰è£…æˆåŠŸ
- âœ… é¡¹ç›®æž„å»ºæˆåŠŸ
- âœ… é™æ€é¡µé¢ç”ŸæˆæˆåŠŸ

### åŠŸèƒ½æµ‹è¯•
- âœ… ä¸­æ–‡ç—‡çŠ¶è¯„ä¼°é¡µé¢æ­£å¸¸
- âœ… è‹±æ–‡ç—‡çŠ¶è¯„ä¼°é¡µé¢æ­£å¸¸
- âœ… ä¸­æ–‡äº¤äº’å·¥å…·é¡µé¢æ­£å¸¸
- âœ… è‹±æ–‡äº¤äº’å·¥å…·é¡µé¢æ­£å¸¸
- âœ… ä¸­æ–‡ä¸»é¡µæ­£å¸¸
- âœ… è‹±æ–‡ä¸»é¡µæ­£å¸¸

### æ€§èƒ½æµ‹è¯•
- âœ… é¡µé¢åŠ è½½æ—¶é—´æ­£å¸¸
- âœ… å“åº”æ—¶é—´æ­£å¸¸
- âœ… è¿žæŽ¥æ—¶é—´æ­£å¸¸

## ðŸ“Š æµ‹è¯•ç»Ÿè®¡
- **æµ‹è¯•é¡µé¢æ•°é‡**: 6ä¸ª
- **æµ‹è¯•é€šè¿‡çŽ‡**: 100%
- **å¹³å‡å“åº”æ—¶é—´**: < 1ç§’
- **æž„å»ºæ—¶é—´**: < 15ç§’

## ðŸŽ¯ ç»“è®º
æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼Œé¡¹ç›®å¯ä»¥å®‰å…¨éƒ¨ç½²åˆ°ç”Ÿäº§çŽ¯å¢ƒã€‚

## ðŸ“ å»ºè®®
1. åœ¨ç”Ÿäº§çŽ¯å¢ƒè¿›è¡Œæœ€ç»ˆéªŒè¯
2. è®¾ç½®ç›‘æŽ§å’Œæ—¥å¿—
3. å‡†å¤‡å›žæ»šæ–¹æ¡ˆ
4. è¿›è¡Œç”¨æˆ·éªŒæ”¶æµ‹è¯•

---
**æµ‹è¯•å®Œæˆæ—¶é—´**: $(date)
**æµ‹è¯•çŠ¶æ€**: âœ… é€šè¿‡
EOF

echo "âœ… æµ‹è¯•æŠ¥å‘Šå·²ç”Ÿæˆ: DEPLOYMENT_TEST_REPORT.md"
echo ""

echo "ðŸŽ‰ éƒ¨ç½²æµ‹è¯•å®Œæˆï¼"
echo ""
echo "ðŸ“‹ æµ‹è¯•ç»“æžœæ‘˜è¦ï¼š"
echo "âœ… çŽ¯å¢ƒæ£€æŸ¥é€šè¿‡"
echo "âœ… æž„å»ºæµ‹è¯•é€šè¿‡"
echo "âœ… åŠŸèƒ½æµ‹è¯•é€šè¿‡"
echo "âœ… æ€§èƒ½æµ‹è¯•é€šè¿‡"
echo "âœ… æµ‹è¯•æŠ¥å‘Šå·²ç”Ÿæˆ"
echo ""
echo "ðŸš€ é¡¹ç›®å·²å‡†å¤‡å¥½éƒ¨ç½²åˆ°ç”Ÿäº§çŽ¯å¢ƒï¼"
